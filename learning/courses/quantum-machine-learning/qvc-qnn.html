<!doctype html>
<html lang="tl" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-learning/courses/quantum-machine-learning/qvc-qnn" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">QVCs and QNNs | doQumentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tl.doqumentation.org/img/rasqberry-social-card.png"><meta data-rh="true" name="twitter:image" content="https://tl.doqumentation.org/img/rasqberry-social-card.png"><meta data-rh="true" property="og:url" content="https://tl.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn"><meta data-rh="true" property="og:locale" content="tl"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" property="og:locale:alternate" content="de"><meta data-rh="true" property="og:locale:alternate" content="es"><meta data-rh="true" property="og:locale:alternate" content="uk"><meta data-rh="true" property="og:locale:alternate" content="fr"><meta data-rh="true" property="og:locale:alternate" content="it"><meta data-rh="true" property="og:locale:alternate" content="pt"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" property="og:locale:alternate" content="ar"><meta data-rh="true" property="og:locale:alternate" content="he"><meta data-rh="true" name="docusaurus_locale" content="tl"><meta data-rh="true" name="docsearch:language" content="tl"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="QVCs and QNNs | doQumentation"><meta data-rh="true" name="description" content="Quantum variational circuits are applied to the recognition of patterns in an image. The parallels with classical neural networks are discussed."><meta data-rh="true" property="og:description" content="Quantum variational circuits are applied to the recognition of patterns in an image. The parallels with classical neural networks are discussed."><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://tl.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn"><link data-rh="true" rel="alternate" href="https://doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="en"><link data-rh="true" rel="alternate" href="https://de.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="de"><link data-rh="true" rel="alternate" href="https://es.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="es"><link data-rh="true" rel="alternate" href="https://uk.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="uk"><link data-rh="true" rel="alternate" href="https://fr.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="fr"><link data-rh="true" rel="alternate" href="https://it.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="it"><link data-rh="true" rel="alternate" href="https://pt.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="pt"><link data-rh="true" rel="alternate" href="https://ja.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="ja"><link data-rh="true" rel="alternate" href="https://tl.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="tl"><link data-rh="true" rel="alternate" href="https://ar.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="ar"><link data-rh="true" rel="alternate" href="https://he.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="he"><link data-rh="true" rel="alternate" href="https://doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Quantum machine learning","item":"https://tl.doqumentation.org/learning/courses/quantum-machine-learning/"},{"@type":"ListItem","position":2,"name":"QVCs and QNNs","item":"https://tl.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn"}]}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
<script src="https://unpkg.com/thebelab@0.4.0/lib/index.js" async></script><link rel="stylesheet" href="/assets/css/styles.9884e938.css">
<script src="/assets/js/runtime~main.81f0038b.js" defer="defer"></script>
<script src="/assets/js/main.36451ee5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Lumaktaw sa pangunahing nilalaman"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Lumaktaw sa pangunahing nilalaman</a></div><nav aria-label="Pangunahing nabigasyon" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="I-toggle ang navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="doQumentation Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="doQumentation Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">doQumentation</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tutorials">Mga Tutorial</a><a class="navbar__item navbar__link" href="/guides">Mga Gabay</a><a class="navbar__item navbar__link" href="/learning/courses/basics-of-quantum-information">Mga Kurso</a><a class="navbar__item navbar__link" href="/learning/modules/computer-science">Mga Modyul</a><a href="https://quantum.cloud.ibm.com/docs/en/api" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Sanggunian ng API<svg width="13.5" height="13.5" aria-label="(magbubukas sa bagong tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link navbar-locale-dropdown"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Filipino</a><ul class="dropdown__menu"><li><a href="https://doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="https://de.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="de">Deutsch</a></li><li><a href="https://es.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="es">Español</a></li><li><a href="https://uk.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="uk">Українська</a></li><li><a href="https://fr.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="fr">Français</a></li><li><a href="https://it.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="it">Italiano</a></li><li><a href="https://pt.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="pt">Português</a></li><li><a href="https://ja.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li><li><a href="/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="tl">Filipino</a></li><li><a href="https://ar.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ar">العربية</a></li><li><a href="https://he.doqumentation.org/learning/courses/quantum-machine-learning/qvc-qnn" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="he">עברית</a></li></ul></div><a class="navbar__item navbar__link header-settings-link" aria-label="Settings" href="/jupyter-settings">Settings</a><a href="https://github.com/JanLahmann/doQumentation" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub<svg width="13.5" height="13.5" aria-label="(magbubukas sa bagong tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="System mode" aria-label="Magpalipat-lipat sa pagitan ng madilim at maliwanag na view (kasalukuyang System mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Maghanap" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Bumalik sa itaas" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Sidebar ng dokumentasyon" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><div class="dq-sidebar-link"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/"><span title="Home" class="linkLabel_WmDU">Home</span></a></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/tutorials"><span title="Mga Tutorial" class="categoryLinkLabel_W154">Mga Tutorial</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Mga Tutorial&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/guides"><span title="Mga Gabay" class="categoryLinkLabel_W154">Mga Gabay</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Mga Gabay&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/learning/courses/basics-of-quantum-information"><span title="Mga Kurso" class="categoryLinkLabel_W154">Mga Kurso</span></a></div><ul class="menu__list"><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/basics-of-quantum-information"><span title="Mga pangunahing kaalaman sa quantum information" class="categoryLinkLabel_W154">Mga pangunahing kaalaman sa quantum information</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Mga pangunahing kaalaman sa quantum information&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/foundations-of-quantum-error-correction"><span title="Mga pundasyon ng quantum error correction" class="categoryLinkLabel_W154">Mga pundasyon ng quantum error correction</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Mga pundasyon ng quantum error correction&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/fundamentals-of-quantum-algorithms"><span title="Mga pangunahing kaalaman sa mga quantum algorithm" class="categoryLinkLabel_W154">Mga pangunahing kaalaman sa mga quantum algorithm</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Mga pangunahing kaalaman sa mga quantum algorithm&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/general-formulation-of-quantum-information"><span title="Pangkalahatang formulasyon ng quantum information" class="categoryLinkLabel_W154">Pangkalahatang formulasyon ng quantum information</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Pangkalahatang formulasyon ng quantum information&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/integrating-quantum-and-high-performance-computing"><span title="Pagsasama ng quantum at high-performance computing" class="categoryLinkLabel_W154">Pagsasama ng quantum at high-performance computing</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Pagsasama ng quantum at high-performance computing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/quantum-business-foundations"><span title="Mga pundasyon ng quantum sa negosyo" class="categoryLinkLabel_W154">Mga pundasyon ng quantum sa negosyo</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Mga pundasyon ng quantum sa negosyo&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/quantum-chem-with-vqe"><span title="Quantum chemistry gamit ang VQE" class="categoryLinkLabel_W154">Quantum chemistry gamit ang VQE</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Quantum chemistry gamit ang VQE&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/quantum-computing-in-practice"><span title="Quantum computing sa kasanayan" class="categoryLinkLabel_W154">Quantum computing sa kasanayan</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Quantum computing sa kasanayan&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/quantum-diagonalization-algorithms"><span title="Mga quantum diagonalization algorithm" class="categoryLinkLabel_W154">Mga quantum diagonalization algorithm</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Mga quantum diagonalization algorithm&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/learning/courses/quantum-machine-learning"><span title="Quantum machine learning" class="categoryLinkLabel_W154">Quantum machine learning</span></a><button aria-label="I-collapse ang kategorya ng sidebar na &#x27;Quantum machine learning&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><div class="dq-sidebar-link"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/courses/quantum-machine-learning/introduction"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li></div><div class="dq-sidebar-link"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/courses/quantum-machine-learning/classical-ml-review"><span title="Classical ML review" class="linkLabel_WmDU">Classical ML review</span></a></li></div><div class="dq-sidebar-link"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/courses/quantum-machine-learning/data-encoding"><span title="Data encoding" class="linkLabel_WmDU">Data encoding</span></a></li></div><div class="dq-sidebar-link"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/courses/quantum-machine-learning/quantum-kernel-methods"><span title="Quantum kernel methods" class="linkLabel_WmDU">Quantum kernel methods</span></a></li></div><div class="dq-sidebar-link"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/learning/courses/quantum-machine-learning/qvc-qnn"><span title="QVCs and QNNs" class="linkLabel_WmDU">QVCs and QNNs</span></a></li></div><div class="dq-sidebar-link"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/courses/quantum-machine-learning/exam"><span title="Exam | Quantum machine learning" class="linkLabel_WmDU">Exam | Quantum machine learning</span></a></li></div></ul></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/quantum-safe-cryptography"><span title="Praktikal na panimula sa quantum-safe cryptography" class="categoryLinkLabel_W154">Praktikal na panimula sa quantum-safe cryptography</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Praktikal na panimula sa quantum-safe cryptography&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/utility-scale-quantum-computing"><span title="Utility-scale quantum computing" class="categoryLinkLabel_W154">Utility-scale quantum computing</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Utility-scale quantum computing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/learning/courses/variational-algorithm-design"><span title="Disenyo ng variational algorithm" class="categoryLinkLabel_W154">Disenyo ng variational algorithm</span></a><button aria-label="I-expand ang kategorya ng sidebar na &#x27;Disenyo ng variational algorithm&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></div></ul></li></div><div class="dq-sidebar-category"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/learning/modules/computer-science"><span title="Mga Modyul" class="categoryLinkLabel_W154">Mga Modyul</span></a></div></li></div></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Mga Kurso</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/learning/courses/quantum-machine-learning"><span>Quantum machine learning</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">QVCs and QNNs</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sa pahinang ito</button></div><div class="theme-doc-markdown markdown">
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Hindi pa naisalin</div><div class="admonitionContent_BuS1"><p>Ang pahinang ito ay hindi pa naisalin. Nakikita mo ang orihinal na bersyon sa Ingles.</p></div></div>
<!-- -->
<!-- -->
<header><h1>Quantum Variational Circuits and Quantum Neural Networks</h1></header>
<p>In this lesson, we implement several variational quantum circuits for a data classification task, so-called variational quantum classifiers (VQCs). At one point, it was common to refer to a subset of VQCs as quantum neural networks (QNNs) in analogy with classical neural networks. Indeed, there are cases where structures borrowed from classical neural networks, such as convolution layers, play an important role in VQCs. In such cases where the analogy is strong, QNNs may be a useful description. But parameterized quantum circuits need not follow the general structure of a neural network; for example, not all data need to be loaded in the first (input) layer; we can load some data in the first layer, apply some gates and then load additional data (a process called data &quot;reuploading&quot;). We should therefore think of QNNs as a subset of parameterized quantum circuits, and we should not be limited in our exploration of useful quantum circuits by the analogy to classical neural networks.</p>
<p>The dataset being addressed in this lesson consists of images containing horizontal and vertical stripes, and our goal is to label unseen images into one of the two categories depending on the orientation of their line. We will accomplish this with a VQC. As we go, we will address ways in which the calculation can be improved and scaled. The dataset here is exceptionally easy to classify classically. It has been chosen for its simplicity so we can focus on the quantum part of this problem, and look at how a dataset attribute might translate to a part of a quantum circuit. It is not reasonable to expect a quantum speed-up for such simple cases where classical algorithms are so efficient.</p>
<p>By the end of this lesson you should be able to:</p>
<ul>
<li class="">Load data from an image into a quantum circuit</li>
<li class="">Construct an ansatz for a VQC (or QNN), and adjust it to fit your problem</li>
<li class="">Train your VQC/QNN and use it to make accurate predictions on test data</li>
<li class="">Scale the problem, and recognize limits of current quantum computers</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="data-generation">Data generation<a href="#data-generation" class="hash-link" aria-label="Direktang link sa Data generation" title="Direktang link sa Data generation" translate="no">​</a></h2>
<p>We will start by constructing the data. Data sets are often not explicitly generated as part of the Qiskit patterns framework. But data type and preparation is critical to successfully applying quantum computing to machine learning. The code below defines a data set of images with set pixel dimensions. One full row or column of the image is assigned the value <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\pi/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.03588em">π</span><span class="mord">/2</span></span></span></span>, and the remaining pixels are assigned random values on the interval <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>π</mi><mi mathvariant="normal">/</mi><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(0,\pi/4)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal" style="margin-right:0.03588em">π</span><span class="mord">/4</span><span class="mclose">)</span></span></span></span>. The random values are noise in our data. Glance through the code to make sure you understand how the images are generated. Later on we will scale up the images.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic"># Added by doQumentation — installs packages not in the Binder environment</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token operator" style="color:#393A34">%</span><span class="token plain">pip install </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">q scikit</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">learn</span></span><br></span></code></pre></div></div></div></div>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic"># This code defines the images to be classified:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Total number of &quot;pixels&quot;/qubits</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># One dimension of the image (called vertical, but it doesn&#x27;t matter). Must be a divisor of `size`</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">vert_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The length of the line to be detected (yellow). Must be less than or equal to the smallest dimension of the image (`&lt;=min(vert_size,size/vert_size)`</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">line_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generate_dataset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_images</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    images </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    hor_array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">line_size </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> vert_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ver_array </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> vert_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vert_size </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> line_size </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> vert_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> vert_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> line_size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> p </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> line_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                hor_array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pi </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            j </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Make two adjacent entries pi/2, then move down to the next row. Careful to avoid the &quot;pixels&quot; at size/vert_size - linesize, because we want to fold this list into a grid.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> vert_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vert_size </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> line_size </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> p </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> line_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            ver_array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> vert_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pi </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        j </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Make entries pi/2, spaced by the length/rows, so that when folded, the entries appear on top of each other.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_images</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        rng </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">randint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> rng </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            labels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            random_image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">randint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hor_array</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            images</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hor_array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">random_image</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> rng </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            labels</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            random_image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">randint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ver_array</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            images</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ver_array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">random_image</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Randomly select 0 or 1 for a horizontal or vertical array, assign the corresponding label.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Create noise</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> images</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                images</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pi </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labels</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">hor_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> vert_size</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p>Note that the code above has also generated labels indicated whether the images contain a vertical (+1) or horizontal (-1) line. We will now use sklearn to split a data set of 100 images into a training and testing set (along with their corresponding labels). Here, we use <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>70</mn></mrow><annotation encoding="application/x-tex">70%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">70</span></span></span></span> of the data set for training, with the remaining <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn></mrow><annotation encoding="application/x-tex">30%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">30</span></span></span></span> withheld for testing.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> train_test_split</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> generate_dataset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_labels</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_test_split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labels</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> random_state</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">246</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p>Let&#x27;s plot a few elements of our data set to see what these lines look like:</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> plt</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Make subplot titles so we can identify categories</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">titles </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;category: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    titles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">title</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate a figure with nested images using subplots.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subplots</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> figsize</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> subplot_kw</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;xticks&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;yticks&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ax</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">//</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        train_images</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vert_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hor_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        aspect</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;equal&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ax</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">//</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_title</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">titles</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subplots_adjust</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wspace</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hspace</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.3</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p><img decoding="async" loading="lazy" alt="Output of the previous code cell" src="data:image/avif;base64,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" width="614" height="504" class="img_ev3q"></p>
<p>Each of these images is still paired with its label in <code>train_labels</code> in a simple list form:</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[1, 1, 1, 1, -1, 1, 1, 1]</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="variational-quantum-classifier-a-first-attempt">Variational quantum classifier: a first attempt<a href="#variational-quantum-classifier-a-first-attempt" class="hash-link" aria-label="Direktang link sa Variational quantum classifier: a first attempt" title="Direktang link sa Variational quantum classifier: a first attempt" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="qiskit-patterns-step-1-map-the-problem-to-a-quantum-circuit">Qiskit patterns step 1: Map the problem to a quantum circuit<a href="#qiskit-patterns-step-1-map-the-problem-to-a-quantum-circuit" class="hash-link" aria-label="Direktang link sa Qiskit patterns step 1: Map the problem to a quantum circuit" title="Direktang link sa Qiskit patterns step 1: Map the problem to a quantum circuit" translate="no">​</a></h3>
<p>The goal is to find a function <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span></span></span></span> with parameters <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span> that maps a data vector / image <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>x</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">x</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.2077em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span> to the correct category: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo><mo>→</mo><mo>±</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">f_\theta(\vec{x}) \rightarrow \pm1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">x</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.2077em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">±</span><span class="mord">1</span></span></span></span>. This will be accomplished using a VQC with few layers that can be identified by their distinct purposes:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>f</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">⟨</mo><mn>0</mn><mi mathvariant="normal">∣</mi><msup><mi>U</mi><mo lspace="0em" rspace="0em">†</mo></msup><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo><msup><mi>W</mi><mo>†</mo></msup><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mi>O</mi><mi>W</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mi>U</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo><mi mathvariant="normal">∣</mi><mn>0</mn><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">f_\theta(\vec{x}) = \langle 0|U^{\dagger}(\vec{x})W^\dagger(\theta)OW(\theta)U(\vec{x})|0\rangle</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">x</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.2077em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.1491em;vertical-align:-0.25em"></span><span class="mopen">⟨</span><span class="mord">0∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">†</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">x</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.2077em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">†</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">x</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.2077em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">∣0</span><span class="mclose">⟩</span></span></span></span></span>
<p>Here, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">U(\vec{x})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">x</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.2077em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> is the encoding circuit, for which we have many options as seen in previous lessons. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">W(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span> is a variational, or trainable circuit block, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span> is the set of parameters to be trained. Those parameters will be varied by classical optimization algorithms to find the set of parameters that yields the best classification of images by the quantum circuit. This variational circuit is sometimes called the &quot;ansatz&quot;. Finally, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi></mrow><annotation encoding="application/x-tex">O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span></span></span></span> is some observable that will be estimated using the Estimator primitive. There is no constraint that forces the layers to come in this order, or even to be fully separate. One could have multiple variational and/or encoding layers in any order that is technically motivated.</p>
<p>We start by choosing a feature map to encode our data. We will use the <code>z_feature_map</code>, as it keeps circuit depths low compared to some other feature mappings.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">library </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> z_feature_map</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># One qubit per data feature</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">num_qubits </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Data encoding</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Note that qiskit orders parameters alphabetically. We assign the parameter prefix &quot;a&quot; to ensure our data encoding goes to the first part of the circuit, the feature mapping.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">feature_map </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> z_feature_map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameter_prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p>We must now decide on an ansatz to be trained. There are many considerations when selecting an ansatz. A complete description is beyond the scope of this introduction; here we simply point out a few categories of considerations.</p>
<ol>
<li class=""><strong>Hardware:</strong> All modern quantum computers are more prone to errors and more susceptible to noise than their classical counterparts. Using an ansatz that is excessively deep (especially in transpiled, two-qubit depth) will not produce good results. A related issue is that quantum computers have some qubit layout, meaning that some physical qubits are adjacent on the quantum computer, and others may be very far from each other. Entangling adjacent qubits does not increase the depth by too much, but entangling very distant qubits can increase depth substantially, as we must insert swap gates to move information onto qubits that are adjacent in order for them to be entangled.</li>
<li class=""><strong>The problem:</strong> Whenever you have some information about your problem that could guide your ansatz, make use of it. For example, the data in this lesson is made up of images of horizontal and vertical lines. One could consider what correlation between adjacent colors/values identifies an image of a horizontal or vertical line. What attributes of an ansatz would correspond to this correlation between adjacent pixels? We will revisit this point more technically later in this lesson. But for now, let us simply say that including entanglement and CNOT gates between qubits corresponding to adjacent pixels seems like a good idea. In the bigger picture, consider whether the problem is actually best solved using a quantum circuit, or whether classical algorithms might exist that can do as good a job.</li>
<li class=""><strong>Number of parameters:</strong> Each independently parameterized quantum gate in the circuit increases the space to be classically optimized, and this results in slower convergence. But as problems scale up, one may encounter <em>barren plateaus</em>. This term refers to a phenomenon where the optimization landscape of a variational quantum algorithm becomes exponentially flat and featureless as the problem size increases. This causes vanishing gradients, making it difficult to effectively train the algorithm<a href="#references" class="">[1]</a>. Barren plateaus are relevant to variational quantum algorithms like VQCs/QNNs. It should be noted that the increasing number of parameters is not the only consideration in avoiding barren plateaus; other considerations include global cost functions and random parameter initialization.</li>
</ol>
<p>In this lesson we will see a few simple examples of good practices in ansatz construction. Let us first try the ansatz below. We will return to revise it, later.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic"># Import the necessary packages</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> QuantumCircuit</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">circuit </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ParameterVector</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Initialize the circuit using the same number of qubits as the image has pixels</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">qnn_circuit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> QuantumCircuit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># We choose to have two variational parameters for each qubit.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParameterVector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;θ&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> length</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># A first variational layer:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Here is a list of qubit pairs between which we want CNOT gates. The choice of these is not yet obvious.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">qnn_cnot_list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">qnn_cnot_list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">qnn_cnot_list</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> qnn_cnot_list</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The second variational layer:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Check the circuit depth, and the two-qubit gate depth</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;2+ qubit depth: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">qnn_circuit</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">decompose</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">depth</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation keyword" style="color:#00009f">lambda</span><span class="token string-interpolation interpolation"> instr</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">instr</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">qubits</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation operator" style="color:#393A34">&gt;</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Draw the circuit</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">draw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mpl&quot;</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2+ qubit depth: 3</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────┐             ┌──────────┐                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q_0: ┤ Ry(θ[0]) ├──────■──────┤ Rx(θ[8]) ├─────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ├──────────┤    ┌─┴─┐    └──────────┘┌──────────┐             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q_1: ┤ Ry(θ[1]) ├────┤ X ├─────────■──────┤ Rx(θ[9]) ├─────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ├──────────┤    └───┘       ┌─┴─┐    └──────────┘┌───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q_2: ┤ Ry(θ[2]) ├────────────────┤ X ├─────────■──────┤ Rx(θ[10]) ├</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ├──────────┤                └───┘       ┌─┴─┐    ├───────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q_3: ┤ Ry(θ[3]) ├────────────────────────────┤ X ├────┤ Rx(θ[11]) ├</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ├──────────┤┌───────────┐               └───┘    └───────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q_4: ┤ Ry(θ[4]) ├┤ Rx(θ[12]) ├─────────────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ├──────────┤├───────────┤                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q_5: ┤ Ry(θ[5]) ├┤ Rx(θ[13]) ├─────────────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ├──────────┤├───────────┤                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q_6: ┤ Ry(θ[6]) ├┤ Rx(θ[14]) ├─────────────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ├──────────┤├───────────┤                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q_7: ┤ Ry(θ[7]) ├┤ Rx(θ[15]) ├─────────────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     └──────────┘└───────────┘</span><br></span></code></pre></div></div>
<p>With the data encoding and variational circuit prepared, we can combine them to form our full ansatz. In this case, the components of our quantum circuit are quite analogous to those in neural networks, with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo stretchy="false">(</mo><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">U(\vec{x})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">x</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.2077em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> being most similar to the layer that loads input values from the image, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">W(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.13889em">W</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span> being like the layer of variable &quot;weights&quot;. Since this analogy holds in this case, we are adopting &quot;qnn&quot; in some of our naming conventions; but this analogy should not be limiting in your exploration of VQCs.</p>
<p><img decoding="async" loading="lazy" alt="QML_CR_background_QNN_circuit-2.png" src="/assets/images/qml-cr-background-qnn-circuit-b82babea2651f9b60512f1d606f591ee.avif" width="4400" height="1649" class="img_ev3q"></p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic"># QNN ansatz</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">ansatz </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> qnn_circuit</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Combine the feature map with the ansatz</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> QuantumCircuit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feature_map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ansatz</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Display the circuit</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">draw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mpl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;clifford&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fold</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p><img decoding="async" loading="lazy" alt="Output of the previous code cell" src="data:image/avif;base64,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" width="692" height="560" class="img_ev3q"></p>
<p>We must now define an observable, so we can use it in our cost function. We will obtain an expectation value for this observable using Estimator. If we have selected a good, problem-motivated ansatz, then each qubit will contain information relevant to classification. One can add layers to combine information onto fewer qubits (called a <em>convolutional layer</em>), such that measurements are only needed on a subset of the qubits in the circuit (as in convolutional neural networks). Or one can measure some attribute from each qubit. Here we will opt for the latter, so we include a <code>Z</code> operator for each qubit. There is nothing unique about choosing <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">Z</span></span></span></span>, but it is well motivated:</p>
<ul>
<li class="">This is a binary classification task, and a measurement of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">Z</span></span></span></span> can yield two possible outcomes.</li>
<li class="">The eigenvalues of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.07153em">Z</span></span></span></span> (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>±</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\pm 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">±</span><span class="mord">1</span></span></span></span>) are reasonably well separated, and result in an estimator outcome in interval [-1, +1], where 0 can simply be used as a cutoff value.</li>
<li class="">It is straightforward to measure in Pauli Z basis with no extra gate overhead.</li>
</ul>
<p>So, Z is a very natural choice.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">quantum_info </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SparsePauliOp</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">observable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SparsePauliOp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Z&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p>We have our quantum circuit and the observable we want to estimate. Now we need a few things in order to run and optimize this circuit. First, we need a function to run a forward pass. Note that the function below takes in the <code>input_params</code> and <code>weight_params</code> separately. The former is the set of static parameters describing the data in an image, and the latter is the set of variable parameters to be optimized.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">primitives </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BaseEstimatorV2</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">quantum_info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">base_operator </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BaseOperator</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    circuit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> QuantumCircuit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    input_params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ndarray</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    weight_params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ndarray</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    estimator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BaseEstimatorV2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    observable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BaseOperator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ndarray</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    Forward pass of the neural network.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    Args:</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">        circuit: circuit consisting of data loader gates and the neural network ansatz.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">        input_params: data encoding parameters.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">        weight_params: neural network ansatz parameters.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">        estimator: EstimatorV2 primitive.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">        observable: a single observable to compute the expectation over.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    Returns:</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">        expectation_values: an array (for one observable) or a matrix (for a sequence of observables) of expectation values.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">        Rows correspond to observables and columns to data samples.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    num_samples </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> input_params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    weights </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">broadcast_to</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">weight_params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_samples</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">weight_params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concatenate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> weights</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    pub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">circuit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> observable</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    job </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> estimator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pub</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> job</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    expectation_values </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">evs</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> expectation_values</span></span><br></span></code></pre></div></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="loss-function">Loss function<a href="#loss-function" class="hash-link" aria-label="Direktang link sa Loss function" title="Direktang link sa Loss function" translate="no">​</a></h3>
<p>Next, we need a loss function to calculate the difference between the predicted and calculated values of the labels. The function will take in the labels predicted by the algorithm and the correct labels and return the mean squared difference. There any many different loss functions. Here, MSE is an example that we chose.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mse_loss</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ndarray</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ndarray</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ndarray</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    Mean squared error (MSE).</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    prediction: predictions from the forward pass of neural network.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    target: true labels.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    output: MSE loss.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predict </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> AssertionError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;input should be 1d-array&quot;</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p>Let us also define a slightly different loss function that is a function of the variable parameters (weights), for use by the classical optimizer. This function only takes the ansatz parameters as input; other variables for the forward pass and the loss are set as global parameters. The optimizer will train the model by sampling different weights and attempting to lower the output of the cost/loss function.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mse_loss_weights</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">weight_params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ndarray</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ndarray</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    Cost function for the optimizer to update the ansatz parameters.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    weight_params: ansatz parameters to be updated by the optimizer.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    output: MSE loss.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    predictions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        circuit</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">circuit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        input_params</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">input_params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        weight_params</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">weight_params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        estimator</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">estimator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        observable</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">observable</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mse_loss</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predict</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    objective_func_vals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> </span><span class="token builtin">iter</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">iter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Iter: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">iter</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, loss: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">cost</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token builtin">iter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> cost</span></span><br></span></code></pre></div></div></div></div>
<p>Above we referred to using a classical optimizer. When we get to searching through weights to minimize the cost function, we will use the optimizer COBYLA:</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> scipy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">optimize </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> minimize</span></span><br></span></code></pre></div></div></div></div>
<p>We will set some initial global variables for the cost function.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic"># Globals</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">circuit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> full_circuit</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">observables </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> observable</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># input_params = train_images_batch</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># target = train_labels_batch</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">objective_func_vals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token builtin">iter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span></span><br></span></code></pre></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="qiskit-patterns-step-2-optimize-problem-for-quantum-execution">Qiskit Patterns Step 2: Optimize problem for quantum execution<a href="#qiskit-patterns-step-2-optimize-problem-for-quantum-execution" class="hash-link" aria-label="Direktang link sa Qiskit Patterns Step 2: Optimize problem for quantum execution" title="Direktang link sa Qiskit Patterns Step 2: Optimize problem for quantum execution" translate="no">​</a></h2>
<p>We start by selecting a backend for execution. In this case, we will use the least-busy backend.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit_ibm_runtime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> QiskitRuntimeService</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">service </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> QiskitRuntimeService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">backend </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">least_busy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operational</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> simulator</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backend</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ibm_brisbane</span><br></span></code></pre></div></div>
<p>Here we optimize the circuit for running on a real backend by specifying the optimization_level and adding dynamical decoupling. The code below generates a pass manager using preset pass managers from qiskit.transpiler.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">library </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> XGate</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transpiler </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PassManager</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transpiler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">passes </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ALAPScheduleAnalysis</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ConstrainedReschedule</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    PadDynamicalDecoupling</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transpiler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">preset_passmanagers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> generate_preset_pass_manager</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> backend</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> generate_preset_pass_manager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> optimization_level</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">scheduling </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PassManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        ALAPScheduleAnalysis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        ConstrainedReschedule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            acquire_alignment</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">acquire_alignment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            pulse_alignment</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pulse_alignment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        PadDynamicalDecoupling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            dd_sequence</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">XGate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> XGate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            pulse_alignment</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pulse_alignment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p>Now we use the pass manager on the circuit. The layout changes that result must be applied to the observable as well. For very large circuits, the heuristics used in circuit optimization may not always yield the best and shallowest circuit. In those cases, it makes sense to run such pass managers several times and use the best circuit. We will see this later when we scale up our calculation.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">circuit_ibm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">observable_ibm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">apply_layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">circuit_ibm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layout</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="qiskit-patterns-step-3-execute-using-qiskit-primitives">Qiskit Patterns Step 3: Execute using Qiskit Primitives<a href="#qiskit-patterns-step-3-execute-using-qiskit-primitives" class="hash-link" aria-label="Direktang link sa Qiskit Patterns Step 3: Execute using Qiskit Primitives" title="Direktang link sa Qiskit Patterns Step 3: Execute using Qiskit Primitives" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="loop-over-the-dataset-in-batches-and-epochs">Loop over the dataset in batches and epochs<a href="#loop-over-the-dataset-in-batches-and-epochs" class="hash-link" aria-label="Direktang link sa Loop over the dataset in batches and epochs" title="Direktang link sa Loop over the dataset in batches and epochs" translate="no">​</a></h3>
<p>We first implement the full algorithm using a simulator for cursory debugging and for estimates of error. We can now go over the entire dataset in batches in desired number of epochs to train our quantum neural network.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">primitives </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> StatevectorEstimator </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> Estimator</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">140</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">num_epochs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">num_samples </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Globals</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">circuit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> full_circuit</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">estimator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Estimator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># simulator for debugging</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">observables </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> observable</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">objective_func_vals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token builtin">iter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Random initial weights for the ansatz</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">weight_params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ansatz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pi</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> epoch </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_epochs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_samples </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">//</span><span class="token plain"> batch_size </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Epoch: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">epoch</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, batch: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        start_i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> batch_size</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        end_i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> start_i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> batch_size</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        train_images_batch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">end_i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        train_labels_batch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">end_i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        input_params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_images_batch</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_labels_batch</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token builtin">iter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> minimize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            mse_loss_weights</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> weight_params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;COBYLA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;maxiter&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        weight_params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;x&quot;</span><span class="token punctuation" style="color:#393A34">]</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Epoch: 0, batch: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Iter: 0, loss: 1.0002309063537163</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Iter: 50, loss: 0.9434121445008878</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="qiskit-patterns-step-4-post-process-return-result-in-classical-format">Qiskit Patterns Step 4: Post-process, return result in classical format<a href="#qiskit-patterns-step-4-post-process-return-result-in-classical-format" class="hash-link" aria-label="Direktang link sa Qiskit Patterns Step 4: Post-process, return result in classical format" title="Direktang link sa Qiskit Patterns Step 4: Post-process, return result in classical format" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-and-accuracy">Testing and accuracy<a href="#testing-and-accuracy" class="hash-link" aria-label="Direktang link sa Testing and accuracy" title="Direktang link sa Testing and accuracy" translate="no">​</a></h3>
<p>We now interpret the results from training. We first test the training accuracy over the training set.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> copy</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metrics </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> accuracy_score</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">primitives </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> StatevectorEstimator </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> Estimator  </span><span class="token comment" style="color:#999988;font-style:italic"># simulator</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># from qiskit_ibm_runtime import EstimatorV2 as Estimator  # real quantum computer</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">estimator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Estimator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># estimator = Estimator(backend=backend)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">circuit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;x&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> estimator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> observable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># pred_train = forward(circuit_ibm, np.array(train_images), res[&#x27;x&#x27;], estimator, observable_ibm)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_train_labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> copy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deepcopy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_train_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pred_train_labels </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_train_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pred_train_labels </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_train_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">accuracy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_labels</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Train accuracy: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">accuracy </span><span class="token string-interpolation interpolation operator" style="color:#393A34">*</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">100</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">%&quot;</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[-2.27688499e-02 -1.46227204e-02 -1.73927452e-02  9.93331786e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -4.85553548e-01  1.43558565e-01  8.34567054e-02 -1.40133992e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.52169596e-01 -1.95082515e-01  8.24373578e-03 -9.90696638e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -3.54268344e-02 -4.77017954e-01  1.38713848e-02 -2.99706215e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -5.78378029e-02  3.25528779e-02 -4.11354239e-02 -1.06483708e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.53095800e-01  2.90110884e-02  1.25745450e-02  6.46323079e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.53538943e-01 -1.57694952e-02 -1.67800067e-02 -1.99820822e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.70360075e-01  7.86148038e-03 -2.33373818e-02  6.64233020e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.14895445e-01 -1.11296215e-01  1.15120303e-01 -2.94096140e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.00531392e-03 -1.69209726e-01 -1.26120885e-01  3.26298176e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.33517383e-02 -5.86983444e-02 -4.32341361e-01 -4.36509551e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -4.17940102e-02  1.76935235e-03  8.14479984e-03  1.86985655e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -2.75525019e-01 -1.63229907e-03 -1.08571055e-01 -7.37452387e-04</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -6.44440657e-02  6.72812834e-04  2.16785530e-03  1.41381850e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -9.82570410e-02  4.35973325e-01 -7.62261965e-02 -1.86193980e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.56971183e-02 -4.02757541e-01 -1.53869367e-01  2.29262129e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -7.02788246e-03  3.65719683e-02  4.68232163e-01  2.36434668e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -2.59520939e-02  3.70550137e-01 -1.19630110e-01 -5.79555318e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2.09554455e-01  5.04689780e-02  7.39494314e-02 -1.77647326e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.45407207e-01 -9.54908878e-02  7.56029640e-02 -2.74049696e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3.34885873e-01  1.58546171e-03  1.09339091e-01 -8.84693274e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -2.36450457e-02  1.41892239e-01 -2.34453218e-01 -7.50717757e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.13281310e-01 -1.66649414e-01 -3.17224197e-01 -6.38220597e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3.28916563e-02  3.04739203e-02  2.67720196e-02 -1.16485785e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -3.08115732e-02 -2.95372010e-02 -7.54669023e-02  6.20013872e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -3.85258710e-01 -1.16456443e-01 -7.38548075e-02 -3.20558243e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -4.22284741e-02  1.01285659e-01 -1.76949246e-01 -2.02767491e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.12407344e-01 -3.81408267e-02 -4.33345231e-01 -9.24507501e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -4.21765393e-02 -6.06533771e-02 -2.22257783e-01 -1.17312535e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -6.74132262e-02 -2.76206274e-01 -9.13971800e-02 -2.27653991e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.66358563e-01  2.17230774e-04  5.76426304e-02 -2.82079169e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.15482051e-01 -3.46716009e-01 -3.21448755e-01 -5.20041405e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -2.16833625e-01 -1.06154654e-02 -7.74854811e-02 -3.28257935e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -7.83242410e-02  1.65547682e-01 -2.55294862e-01 -8.89085025e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4.47581491e-01  1.92351832e-02  2.74083885e-02 -3.61304571e-01]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-1. -1. -1.  1. -1.  1.  1. -1.  1. -1.  1. -1. -1. -1.  1. -1. -1.  1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1. -1.  1.  1.  1.  1. -1. -1. -1. -1.  1.  1. -1.  1. -1. -1.  1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1. -1. -1.  1. -1. -1. -1. -1. -1.  1.  1.  1. -1. -1. -1. -1. -1.  1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.  1. -1.  1. -1. -1. -1. -1. -1.  1. -1.  1.  1.  1. -1.  1. -1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.  1.  1. -1. -1. -1.  1. -1.  1.  1.  1. -1. -1.  1. -1. -1. -1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1. -1.  1.  1.  1. -1. -1. -1. -1.  1. -1. -1. -1. -1. -1.  1. -1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1. -1. -1. -1. -1. -1. -1. -1. -1. -1. -1. -1.  1.  1.  1. -1. -1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1. -1. -1. -1. -1. -1. -1.  1. -1. -1.  1.  1.  1. -1.]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1, 1, 1, 1, -1, 1, 1, 1, -1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, 1, -1, 1, 1, -1, 1, 1, 1, 1, -1, 1, 1, -1, 1, 1, -1, 1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, -1, 1, 1, -1, 1, 1, 1, 1, -1, -1, -1, -1, 1, -1, 1, 1, 1, -1, -1, 1, 1, -1, 1, 1, -1, -1, 1, -1, 1, 1, 1, 1, 1, -1, -1, 1, -1, -1, -1, -1, -1, 1, 1, -1, -1, 1, -1, -1, 1, 1, -1, 1, -1, 1, 1, 1, 1, 1, -1, -1, -1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, 1, 1, -1, -1, -1, 1, 1, 1, -1, -1, -1, 1, -1, 1, 1, -1, -1, -1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Train accuracy: 60.0%</span><br></span></code></pre></div></div>
<p>The training accuracy is only <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>60</mn></mrow><annotation encoding="application/x-tex">60%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">60</span></span></span></span>, which is definitely not good. It is hard to imagine that the model&#x27;s performance on the test set could be any better. Let&#x27;s verify.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">circuit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_images</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;x&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> estimator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> observable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># pred_test = forward(circuit_ibm, np.array(test_images), res[&#x27;x&#x27;], estimator, observable_ibm)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_test_labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> copy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deepcopy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_test_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pred_test_labels </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_test_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pred_test_labels </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_test_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">accuracy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_labels</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Test accuracy: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">accuracy </span><span class="token string-interpolation interpolation operator" style="color:#393A34">*</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">100</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">%&quot;</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[-2.77978120e-01 -2.62194862e-01  4.59636095e-02 -8.09344165e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -2.97362966e-01  9.22947242e-02  2.06693174e-01  3.31629460e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.10971762e-03 -2.14602152e-01 -1.62671993e-01 -6.07179155e-04</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.59948633e-01 -8.55722523e-02 -1.13057027e-01 -3.00187433e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -2.92832827e-01  7.38580629e-02 -6.03706270e-02 -8.57643552e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.52402062e-02 -3.57505447e-01 -3.54890597e-02  1.36534749e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.54688180e-01 -2.93714726e-01  1.89548513e-02 -6.15715564e-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.11042670e-01 -2.22861100e-02 -3.84230105e-02  1.67351034e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -8.38766333e-02  2.56348613e-01 -1.10653111e-01 -1.18989476e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -6.75723266e-05 -6.88580547e-02  1.02431393e-02 -2.42125353e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.09142367e-01 -1.22540757e-01 -1.63735850e-01  3.93334838e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2.36705685e-01 -2.34259814e-02 -3.91877756e-02 -1.95106746e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.86707523e-01  4.74775215e-02 -4.24907432e-02 -2.06453265e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4.09184710e-02 -3.54762080e-02 -9.47513112e-02  2.97270112e-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -2.99708696e-02  9.93941064e-03 -1.26760302e-01 -1.36183355e-01]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-1. -1.  1. -1. -1.  1.  1.  1.  1. -1. -1. -1. -1. -1. -1. -1. -1.  1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1. -1. -1. -1. -1.  1. -1. -1.  1. -1.  1. -1. -1.  1. -1.  1. -1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1. -1.  1. -1. -1. -1. -1.  1.  1. -1. -1. -1.  1.  1. -1. -1.  1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.  1. -1.  1. -1. -1.]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-1, -1, 1, 1, -1, -1, 1, -1, 1, -1, 1, 1, 1, 1, -1, 1, -1, 1, 1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, -1, 1, -1, -1, 1, 1, 1, -1, 1, 1, -1, -1, -1, 1, 1, 1, -1, 1, 1, 1, 1, -1, -1, 1, 1, 1, 1, 1, 1, -1, -1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test accuracy: 60.0%</span><br></span></code></pre></div></div>
<p>The model is not classifying these data well. We should ask why this is, and in particular, we should check:</p>
<ul>
<li class="">Did we stop the training too soon? Were more optimization steps needed?</li>
<li class="">Did we construct a bad ansatz? This could mean a lot of things. When we work on real quantum computers, circuit depth will be a major consideration. The number of parameters is also potentially important, as is the entangling between qubits.</li>
<li class="">Combining the two above, did we construct an ansatz with too many parameters to be trainable?</li>
</ul>
<p>We can start by checking for convergence in the optimization:</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">obj_func_vals_first </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> objective_func_vals</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># import matplotlib.pyplot as plt</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">figsize</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj_func_vals_first</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;first ansatz&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;iteration&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;loss&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p><img decoding="async" loading="lazy" alt="Output of the previous code cell" src="data:image/avif;base64,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" width="1010" height="525" class="img_ev3q"></p>
<p>We might try extending the optimization steps to make sure the optimizer didn&#x27;t just get stuck in a local minimum in parameter space. But it looks fairly converged. Let&#x27;s take a closer look at the images that were <em>not</em> classified correctly, and see if we can understand what is happening.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">missed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> pred_test_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> test_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        missed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_images</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">missed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">24</span><br></span></code></pre></div></div>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subplots</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> figsize</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> subplot_kw</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;xticks&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;yticks&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">missed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ax</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">//</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        missed</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vert_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hor_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        aspect</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;equal&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subplots_adjust</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wspace</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.02</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hspace</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.025</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p><img decoding="async" loading="lazy" alt="Output of the previous code cell" src="data:image/avif;base64,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" width="330" height="481" class="img_ev3q"></p>
<p>Here we can see that the vast majority of the wrongly-classified images have a vertical line. Something about our model is failing to capture information about those. You may have seen this coming, based on the first variational circuit. Let&#x27;s look at it more closely.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="improving-the-model">Improving the model<a href="#improving-the-model" class="hash-link" aria-label="Direktang link sa Improving the model" title="Direktang link sa Improving the model" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-revisited">Step 1 revisited<a href="#step-1-revisited" class="hash-link" aria-label="Direktang link sa Step 1 revisited" title="Direktang link sa Step 1 revisited" translate="no">​</a></h3>
<p>In mapping our problem to a quantum circuit, we should have explicitly thought about the how the information in adjacent pixels determines class. In order to identify horizontal lines, we want to know &quot;if pixel <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em"></span><span class="mord mathnormal">i</span></span></span></span> is yellow, is pixel <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">1</span></span></span></span> yellow&quot; for all the pixels across each row. We also want to know about vertical lines. But since the classification is binary, one could imagine simply saying that if such a horizontal line is <em>not</em> detected, then it is a vertical line. Our previous variational circuit contained CNOT gates between qubits (and therefore pixels) 0 and 1, 1 and 2, and 2 and 3. That covers any horizontal lines across the top of the image, but it does not directly detect vertical lines, nor does it completely detect horizontal lines, as it ignores the lower row. To fully detect all horizontal lines, we would want to have a similar set of CNOT gates between qubits (pixels) 4 and 5, 5 and 6, and 6 and 7. We could keep in mind that adding CNOT gates between qubits corresponding to vertical lines (like 0 and 4, or 2 and 6) may also be useful. But we will first check whether it is sufficient to detect that there <em>is</em> or <em>is not</em> a horizontal line.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic"># Initialize the circuit using the same number of qubits as the image has pixels</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">qnn_circuit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> QuantumCircuit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># We choose to have two variational parameters for each qubit.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParameterVector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;θ&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> length</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># A first variational layer:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Here is an extended list of qubit pairs between which we want CNOT gates. This now covers all pixels connected by horizontal lines.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">qnn_cnot_list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">qnn_cnot_list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">qnn_cnot_list</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> qnn_cnot_list</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The second variational layer:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Check the circuit depth, and the two-qubit gate depth</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;2+ qubit depth: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">qnn_circuit</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">decompose</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">depth</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation keyword" style="color:#00009f">lambda</span><span class="token string-interpolation interpolation"> instr</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">instr</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">qubits</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation operator" style="color:#393A34">&gt;</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Combine the feature map and variational circuit</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">ansatz </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> qnn_circuit</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Combine the feature map with the ansatz</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> QuantumCircuit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feature_map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ansatz</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Display the circuit</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">draw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mpl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;clifford&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fold</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2+ qubit depth: 3</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="Output of the previous code cell" src="data:image/avif;base64,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" width="692" height="560" class="img_ev3q"></p>
<p>We have not increased the depth of the circuit. Let&#x27;s see if we have increased its ability to model our images.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-revisited">Step 2 revisited<a href="#step-2-revisited" class="hash-link" aria-label="Direktang link sa Step 2 revisited" title="Direktang link sa Step 2 revisited" translate="no">​</a></h3>
<p>We will need to transpile this new circuit for running on a real quantum backend. Let&#x27;s skip this step for now to see if our revision of the variational circuit has had the desired effect on simulators. We will go deeper into transpilation in the next subsection.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-revisited">Step 3 revisited<a href="#step-3-revisited" class="hash-link" aria-label="Direktang link sa Step 3 revisited" title="Direktang link sa Step 3 revisited" translate="no">​</a></h3>
<p>We now apply the updated model to our training data.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">primitives </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> StatevectorEstimator </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> Estimator</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">140</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">num_epochs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">num_samples </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Globals</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">circuit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> full_circuit</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">estimator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Estimator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># simulator for debugging</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">observables </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> observable</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">objective_func_vals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token builtin">iter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Random initial weights for the ansatz</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">weight_params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ansatz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pi</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> epoch </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_epochs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_samples </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">//</span><span class="token plain"> batch_size </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Epoch: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">epoch</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, batch: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        start_i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> batch_size</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        end_i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> start_i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> batch_size</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        train_images_batch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">end_i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        train_labels_batch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">end_i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        input_params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_images_batch</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_labels_batch</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token builtin">iter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> minimize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            mse_loss_weights</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> weight_params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;COBYLA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;maxiter&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        weight_params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;x&quot;</span><span class="token punctuation" style="color:#393A34">]</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Epoch: 0, batch: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Iter: 0, loss: 1.0049762969140237</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Iter: 50, loss: 0.8274276543780351</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-4-revisited">Step 4 revisited<a href="#step-4-revisited" class="hash-link" aria-label="Direktang link sa Step 4 revisited" title="Direktang link sa Step 4 revisited" translate="no">​</a></h3>
<p>Let&#x27;s start by checking whether our optimizer fully converged.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">obj_func_vals_revised </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> objective_func_vals</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># import matplotlib.pyplot as plt</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">figsize</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj_func_vals_revised</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;revised ansatz&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;iteration&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;loss&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p><img decoding="async" loading="lazy" alt="Output of the previous code cell" src="data:image/avif;base64,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" width="1001" height="525" class="img_ev3q"></p>
<p>This does not appear fully converged, as the loss function has not remained roughly level for substantially many steps. But the loss function is already ~60% lower than when using the previous variational circuit. If this were a research project, we would want to ensure full convergence. But for the purposes of exploration, this is sufficient. Let&#x27;s check the accuracy on our training and testing data.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metrics </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> accuracy_score</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">primitives </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> StatevectorEstimator </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> Estimator  </span><span class="token comment" style="color:#999988;font-style:italic"># simulator</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># from qiskit_ibm_runtime import EstimatorV2 as Estimator  # real quantum computer</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">estimator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Estimator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># estimator = Estimator(backend=backend)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">circuit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;x&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> estimator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> observable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># pred_train = forward(circuit_ibm, np.array(train_images), res[&#x27;x&#x27;], estimator, observable_ibm)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_train_labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> copy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deepcopy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_train_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pred_train_labels </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_train_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pred_train_labels </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_train_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">accuracy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_labels</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Train accuracy: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">accuracy </span><span class="token string-interpolation interpolation operator" style="color:#393A34">*</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">100</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">%&quot;</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[ 0.46144755  0.42579688  0.35255977  0.55207273 -0.48578418  0.50805845</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.44892649  0.6173847  -0.62428139  0.40405121  0.46862421  0.29503395</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.5740469  -0.71794562 -0.45022095 -0.45330418 -0.19795258 -0.46821777</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.5622049  -0.32114059  0.54947838 -0.4889812   0.28327445  0.58149728</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.27026749  0.41328304  0.21119412  0.60108606  0.39204178 -0.24974605</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.38496469  0.39867586 -0.38946996  0.62616766  0.61212525 -0.49719567</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.30860002  0.68443904 -0.27505907 -0.41508947 -0.49666422  0.67716994</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.54696613 -0.70058779  0.42711815 -0.5285338   0.37678572  0.43888249</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.30844464  0.42347715 -0.4250844   0.67324132  0.59914067 -0.45184567</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.13604098  0.65336342  0.26099853  0.60316559 -0.38743183 -0.54784284</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.29549031 -0.45592302  0.41613453 -0.38781528  0.56903087  0.54955451</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.55532336 -0.3931852  -0.57599675  0.61246236  0.42014135 -0.38171749</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.56760389  0.45383135 -0.50473943 -0.47551181  0.54221517 -0.64987023</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.28845851  0.54403865  0.53841148  0.64477078  0.71912049 -0.63178323</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.50764757  0.50304637 -0.38099972 -0.27707127 -0.24353841 -0.52045267</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.61500665  0.65443173  0.31902266 -0.64969037 -0.4814051   0.47980608</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.649786   -0.43048551  0.34562588  0.308998   -0.32454238  0.29558168</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.45410187  0.54600712  0.33204827  0.22627804  0.4283921   0.56191874</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.25400294 -0.6493613  -0.47445293  0.42272138 -0.35472546 -0.52240474</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.45207595  0.40292125 -0.3361856  -0.46620886  0.60202719 -0.56505744</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.47169796 -0.43577622  0.40689437  0.48869108 -0.39701189 -0.57698634</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.39236332  0.31294648  0.41797597  0.63004836 -0.52884541 -0.43805812</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.3193499   0.36860211 -0.49190995  0.65000193  0.50260077 -0.56737168</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.29693083 -0.40956432]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ 1.  1.  1.  1. -1.  1.  1.  1. -1.  1.  1.  1. -1. -1. -1. -1. -1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1. -1.  1. -1.  1.  1. -1.  1.  1.  1.  1. -1.  1.  1. -1.  1.  1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.  1. -1. -1. -1.  1. -1. -1.  1. -1.  1.  1. -1.  1. -1.  1.  1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.  1.  1.  1. -1. -1. -1. -1.  1. -1.  1.  1.  1. -1. -1.  1.  1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.  1. -1. -1.  1. -1.  1.  1.  1.  1.  1. -1. -1.  1. -1. -1. -1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.  1.  1. -1. -1.  1. -1. -1.  1.  1. -1.  1. -1.  1.  1.  1.  1.  1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1. -1. -1.  1. -1. -1. -1.  1. -1. -1.  1. -1.  1. -1.  1.  1. -1. -1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.  1.  1.  1. -1. -1. -1.  1. -1.  1.  1. -1. -1. -1.]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1, 1, 1, 1, -1, 1, 1, 1, -1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, 1, -1, 1, 1, -1, 1, 1, 1, 1, -1, 1, 1, -1, 1, 1, -1, 1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, -1, 1, 1, -1, 1, 1, 1, 1, -1, -1, -1, -1, 1, -1, 1, 1, 1, -1, -1, 1, 1, -1, 1, 1, -1, -1, 1, -1, 1, 1, 1, 1, 1, -1, -1, 1, -1, -1, -1, -1, -1, 1, 1, -1, -1, 1, -1, -1, 1, 1, -1, 1, -1, 1, 1, 1, 1, 1, -1, -1, -1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, 1, 1, -1, -1, -1, 1, 1, 1, -1, -1, -1, 1, -1, 1, 1, -1, -1, -1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Train accuracy: 100.0%</span><br></span></code></pre></div></div>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">circuit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_images</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;x&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> estimator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> observable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># pred_test = forward(circuit_ibm, np.array(test_images), res[&#x27;x&#x27;], estimator, observable_ibm)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_test_labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> copy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deepcopy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_test_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pred_test_labels </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pred_test_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pred_test_labels </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pred_test_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">accuracy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_labels</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test_labels</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Test accuracy: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">accuracy </span><span class="token string-interpolation interpolation operator" style="color:#393A34">*</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">100</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">%&quot;</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[-0.48396136 -0.57123828  0.28373249  0.38983869 -0.45799092 -0.63643031</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.69164877 -0.47749808  0.16965244 -0.39669469  0.39366915  0.44206948</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.69733951  0.40445979 -0.33663432  0.54511581 -0.49397081  0.55934553</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.69269512  0.38875983  0.39724004 -0.49635863 -0.19131387  0.38813936</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.39537369 -0.46262489  0.5307315   0.21783317  0.31949453 -0.49772087</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.56409526 -0.66254365 -0.57507262  0.37363552  0.35154205  0.69295687</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -0.31205475  0.37787066  0.67903997 -0.29984861 -0.46435535 -0.32610974</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.4327188   0.64626537  0.37592731 -0.14328906  0.59694745  0.71880638</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.32414334  0.42119333 -0.60745236 -0.42520033  0.28334222  0.21699081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0.34837252  0.31538989  0.30754545  0.5995197  -0.34678026 -0.46587602]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-1. -1.  1.  1. -1. -1.  1. -1.  1. -1.  1.  1.  1.  1. -1.  1. -1.  1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.  1.  1. -1. -1.  1.  1. -1.  1.  1.  1. -1.  1. -1. -1.  1.  1.  1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -1.  1.  1. -1. -1. -1.  1.  1.  1. -1.  1.  1.  1.  1. -1. -1.  1.  1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1.  1.  1.  1. -1. -1.]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-1, -1, 1, 1, -1, -1, 1, -1, 1, -1, 1, 1, 1, 1, -1, 1, -1, 1, 1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, -1, 1, -1, -1, 1, 1, 1, -1, 1, 1, -1, -1, -1, 1, 1, 1, -1, 1, 1, 1, 1, -1, -1, 1, 1, 1, 1, 1, 1, -1, -1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test accuracy: 100.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$100\%$ accuracy on both sets! Our suspicion about accurate detection of horizontal lines being sufficient was correct! Further, our mapping from required information about the pixels to the CNOT gates in the quantum circuit was effective. Let&#x27;s now look at how this process scales for running on real quantum computers.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Scaling and running on real quantum computers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Let us begin by increasing the size of our images. There is nothing special about the choice of a 6x6 grid, except that it exceeds the number of qubits (32) that we can simulate for circuits using non-Clifford gates.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This code defines the images to be classified:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Total number of &quot;pixels&quot;/qubits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">size = 36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># One dimension of the image (called vertical, but it doesn&#x27;t matter). Must be a divisor of `size`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vert_size = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># The length of the line to be detected (yellow). Must be less than or equal to the smallest dimension of the image (`&lt;=min(vert_size,size/vert_size)`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">line_size = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def generate_dataset(num_images):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    images = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hor_array = np.zeros((size - (line_size - 1) * vert_size, size))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ver_array = np.zeros((round(size / vert_size) * (vert_size - line_size + 1), size))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    j = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(0, size - 1):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if i % (size / vert_size) &lt;= (size / vert_size) - line_size:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for p in range(0, line_size):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hor_array[j][i + p] = np.pi / 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            j += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Make two adjacent entries pi/2, then move down to the next row. Careful to avoid the &quot;pixels&quot; at size/vert_size - linesize, because we want to fold this list into a grid.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    j = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(0, round(size / vert_size) * (vert_size - line_size + 1)):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for p in range(0, line_size):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ver_array[j][i + p * round(size / vert_size)] = np.pi / 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        j += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Make entries pi/2, spaced by the length/rows, so that when folded, the entries appear on top of each other.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for n in range(num_images):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rng = np.random.randint(0, 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if rng == 0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            labels.append(-1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            random_image = np.random.randint(0, len(hor_array))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            images.append(np.array(hor_array[random_image]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Randomly select one of the several rows you made above.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        elif rng == 1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            labels.append(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            random_image = np.random.randint(0, len(ver_array))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            images.append(np.array(ver_array[random_image]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Randomly select one of the several rows you made above.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Create noise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for i in range(size):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if images[-1][i] == 0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                images[-1][i] = np.random.rand() * np.pi / 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return images, labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hor_size = round(size / vert_size)</span><br></span></code></pre></div></div>
<p>Because quantum computing time is a precious commodity, we will use a very small training set, and very few optimization steps. This will be sufficient to demonstrate the workflow.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> train_test_split</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Here we specify a very small data set. Increase for realism, but monitor use of quantum computing time.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> generate_dataset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_labels</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_test_split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    images</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labels</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> random_state</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">246</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> plt</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate a figure with nested images using subplots.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subplots</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> figsize</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> subplot_kw</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;xticks&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;yticks&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ax</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">//</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        train_images</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vert_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hor_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        aspect</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;equal&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subplots_adjust</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wspace</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hspace</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.025</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p><img decoding="async" loading="lazy" alt="Output of the previous code cell" src="data:image/avif;base64,AAAAHGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZgAAAXBtZXRhAAAAAAAAACFoZGxyAAAAAAAAAABwaWN0AAAAAAAAAAAAAAAAAAAAAA5waXRtAAAAAAABAAAANGlsb2MAAAAAREAAAgABAAAAAAGUAAEAAAAAAAAJGQACAAAAAAqtAAEAAAAAAAAAQwAAADhpaW5mAAAAAAACAAAAFWluZmUCAAAAAAEAAGF2MDEAAAAAFWluZmUCAAAAAAIAAGF2MDEAAAAAr2lwcnAAAACKaXBjbwAAAAxhdjFDgQQMAAAAABRpc3BlAAAAAAAAAo4AAAHiAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQQcAAAAAA5waXhpAAAAAAEIAAAAOGF1eEMAAAAAdXJuOm1wZWc6bXBlZ0I6Y2ljcDpzeXN0ZW1zOmF1eGlsaWFyeTphbHBoYQAAAAAdaXBtYQAAAAAAAAACAAEDgQIDAAIEhAIFhgAAABppcmVmAAAAAAAAAA5hdXhsAAIAAQABAAAJZG1kYXQSAAoKGSYo3w8EBDQaEDKIEkyAAvlx6peWfFwf8kA0xERHwV7gwdgLi3Ggl9WT17yXwGrZ3LYXs+suBHZyIr7JMTXeQ8GaZeAZDvJY0Vzv5dqMtp/erHEVhmSWunXGvHI4gVkkJMeufxEaVImvEJ+6HSzR2fftyrYsZBQ6VALSzBvKSlRjLHtIKhRwabGy8HIt5eu8Wc8S5fGh99VA5K1CxJJ7aXddzikgsG+FNMv8IKFkO8XjhSUYzsLxKMFy9NvMKvkq+fB9QzbcImL9aUkpS6BKQMh2lH+PRNx/Ta/HFOoCvRDFBglPNTfznWvZwAGH+3QEP4k8nq78Wnz9VBswEQmLGYY80AjxSncd5ETf7lm2y8EyV/mtAjKVkECLvhrEf742opPzX1jEbBhikgHuQuoAxJiAqwint14wC4ZfKfj7IQx6E3lIH3Xd16YHSjkDjFRFztkgHVQvfubnB8AAMJ8vT1xFbGqS/UtpjpwWwy9foEMzZXpicnNb3JSiXaVGLvc2Fnnbo1c20gY0+s1Gu+jbrqfKo2nk0gdzCmYf2xT2sdTFSOXNATo9PS6R5Cr0NVOF+QW2bLVnz//HZpQflSZOZIOU0VjI4DYgtQKDLW8gw6mtIlFFpM/GV3C+ITMJGubv3iuRk50QwNXIdNLIyc6X5f3deR2XMrM8VKEzWzc0+fQzwX8eME5C0sip3K5KnNmSbsqJmYLWv05kryAB03jq6poy8Oh7IiqMstC+eaNVAQg6TA/GS7Iu/GW6yM51fvBvF+eovYogM5kpQHOJYiekGTVn1bQzpFjmmm4TIQsZRm1HDUDdJlUccegxilcKgeJ2Tm+fQOr9W25CpkZNQ+tmptxiquZbMk1Zdz7gbFy9PjltJMSn/JKvKA6c8plDjdmz3P/xMIrLXonH5VAdIFCRlZMzoNcPViOaSevbzH1bPAkmYagWYYodpwXTUzMzPZNcSJoOGIhlugQnvKAj+Ly86y5GLMN/8aLTz+/PQ14Rl+5NjQuHFW4v5XVuc6gE9dZQ1JMFFd4MSDZLLQja4QcMKRCtuJNN4cbqp97//10zy0F9EyvNu/u5LuRlYMZq8hWXXf7r8x6R4J7Y9YJ3W3VteV1CNEG20+DWoHzhJsKgcUUAgckTcGgvkqlIDvLEPPHy1V00SMK8myNrx03Y6IxIkfxc/ekPOX0Ed/wuOsIaHQAx3UXkSWC8DM45Hj6r2eTHZ/Sd6ZAimcdClpdmPcwNKNBDJ++akpQAFYFboA6jaMTU3zZG7NU5y1l6CqH0Rt0ZtdyFNEqy9h9HvTn6C3KvYXmP+udMvToj5k8hMxmvvL2NjrQ0gBdpCb+Y2eZJYBriC8JT65UsQrr7lk+17poUk64XULRKqCijzrlTAbmYdsDDdNf8zDMQIbzCGCRjmW0T4uTSDdK+D6ubymvBxOJW2oCtv3hjo1ILAuP7vl963sDcfsqTGNb835d1M4tKW9mTJ+tMHz4NaFbZYMf8n/EYw5wfl8o3SdJ8UmPJw/SSwkUUyALgfY684I1layvCmNEYCQPQrABJJkwOTEvnvxaAgvJEmKwkwJdjQVgI6O5vhXKiTmaBRNd0Ou3Ffxx5iPgDmT+/poNP0iCDX/zbnM6k9nR8ThsYnHZOu9soZsS32VBITbWfUPMKmi55mU0ferZjgfYXEfxcLoKFKUIEpm9H1H52NTFRHk7DV3RxfKqya9FGG06qY9F9yprW4hTOvv/xWdv8c8jBUrEX61KgrMyQHZGy1vYQ/Mv7R0ByALAMfOY8SV7U7C39qqPCDKQs16zI1Xpgu+N/I+nwKF/cY//7ZR3epKBJT4P9ALAIsUiEbqdosXO2wHqzKlt43kDbUVEUaMhC/6IbWTS2ybYgOlINFaBziPzN0F2GfeBOC/yrn3a3r1lYYJf80Ns4dnkN5fEe0vFV9HLb6mOMBu3XCqWNPat2ktcXi+mkmNxaAz+FcIUMXPN0+yhyggaLTXbEGHJfxYScOG5aIlOxL3Rqq+dUH2PepiSXzI17wUZQnOk/+FAR/I8g1zXvPL8Hu5b6dQnkufLrM4PDlqQCJL/dY/LaX/j/oZAFAmPxPLaHx28aHUkCGMCS/UVdkGcXlbnQDdpzbPGMXNhkS87EidB96gRVehlqgJk841us/d6zPNJMamR2MvnKwlSJwpVMY+bzN8sZv6helSpN9MmOYS/rVC82x4kZIFVhTJkRYa8mqrVo0Nn1yJ6eMaYDD6FW1I5MyiZwKeL2FmSSi9FHDal4ClOXH3/6bi3/AjccMnL2pBPPxFcw25EUw0o0YvOTYELQ6c305U5wHdEB0nDKZryVW6FA91HIKKWpGm0q7HcV7XyrBOedcq/IarvTYS6VLO3GR3qVdplBemFYePqF1F1XTcvJgAJTsqefQJG0kgogwsWd68K5veUyQAtW5UVwayDjCmVtaEakezQ5b1eoqrhqZ6XzH8XIYRwAJn9c0ALrsx2/rQnkwLrGRz68OTuTrAUlMKEIU+Di77Xf7FFFADYOMW40fIXd/jeJ3by8HKRhUH6n7y/Giiizi3g1Oficn7H+KCjX3Y0phBLCF7MUi2JpVKVBAnmKpkb2oE8SUtiBG8mJ4mgofRWb2YZzTAz//aWtfO8unCwkJhGUYtgyVsN/nmICBVwuE6/bggpBKNHmKQAhCz+ekTD9LwfB/9lnE6AhNn6XZvvacFuifUOzQk6f+OklgmOf1LlVYmTyOGM8Dc6cxH4lr7OJ6lqjWaJlC3W+lT/hSM70qS6Cf32oD+uL3w9Br8hL9EWKccDYbwyCgNg9a1Lc9ipAhxtlP4R12sjx+8etDUZIDE7xR+G3tT2rDGWZN0JpBOZIrjqs8tNxdT8nzxj9Dcf9SqbMZ8AGMO54F/KnEmXwKOLQn6LKAEOGUbn/z0vFUs0tb6jVPij73kls3HUSh2ryKnaf/w1irtWIQlqhR1rRzQ7xJrkcuW9QgusNxbyPAQrSoYaVpik0bAd06yO12jyiTVT3SnKBCgaeJl2bjGMpDxqGY9h5/zLEE+oxRoljeW15Q2fSPDgKGQmlERUAasap0uchsZws68SO0TJlq5LNjwWBgmssJHKLXYcrUt8RjUXAEgAKBxkmKN8PCoAyNhIACihA9PAQ3bAnbp1QrsjYPu8K8cz0mU2dZakcm8Im4wOv8xno+ZRCA3WrHD+CovmIOWN8sA==" width="654" height="482" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-map-the-problem-to-a-quantum-circuit">Step 1: Map the problem to a quantum circuit<a href="#step-1-map-the-problem-to-a-quantum-circuit" class="hash-link" aria-label="Direktang link sa Step 1: Map the problem to a quantum circuit" title="Direktang link sa Step 1: Map the problem to a quantum circuit" translate="no">​</a></h3>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">library </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> z_feature_map</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># One qubit per data feature</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">num_qubits </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Data encoding</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Note that qiskit orders parameters alphabetically. We assign the parameter prefix &quot;a&quot; to ensure our data encoding goes to the first part of the circuit, the feature mapping.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">feature_map </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> z_feature_map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parameter_prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic"># This creates a circuit with the cxs in the compressed order.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> QuantumCircuit</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">circuit </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ParameterVector</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">qnn_circuit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> QuantumCircuit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParameterVector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;θ&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> length</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># CNOT gates between horizontally adjacent qubits.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vert_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> j </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hor_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> hor_size </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> hor_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> j</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> hor_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># CNOT gates between vertically adjacent qubits, likely not necessary based on our preliminary simulation.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#        if i&lt;vert_size-1:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            qnn_circuit.cx((i*hor_size)+j,(i*hor_size)+j+hor_size)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    qnn_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">qnn_circuit_large </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> qnn_circuit</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">qnn_circuit_large</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;2+ qubit depth: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">qnn_circuit_large</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">decompose</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">depth</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation keyword" style="color:#00009f">lambda</span><span class="token string-interpolation interpolation"> instr</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">instr</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">qubits</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation operator" style="color:#393A34">&gt;</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># qnn_circuit_large.draw()</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2+ qubit depth: 5</span><br></span></code></pre></div></div>
<p>This is a reasonable two-qubit depth. We should be able to get high-quality results from a real quantum computer.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic"># Combine the feature map and variational circuit</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">ansatz </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> qnn_circuit</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Combine the feature map with the ansatz</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> QuantumCircuit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feature_map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ansatz</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Check the depth of the full circuit</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;2+ qubit depth: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">full_circuit</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">decompose</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">depth</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation keyword" style="color:#00009f">lambda</span><span class="token string-interpolation interpolation"> instr</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">instr</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">qubits</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation operator" style="color:#393A34">&gt;</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2+ qubit depth: 5</span><br></span></code></pre></div></div>
<p>Because we are using the <code>z_feature_map</code>, which has no CNOT gates, adding the encoding layer does not increase our two-qubit depth. We can visualize the full circuit here.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">draw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mpl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;clifford&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idle_wires</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fold</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p><img decoding="async" loading="lazy" alt="Output of the previous code cell" src="/assets/images/b43806aa-7d41-40b8-9e43-a604f0e42c26-0-6d5926e1f1ead65dd1b8533169f0ef52.avif" width="834" height="2363" class="img_ev3q"></p>
<p>You may note that if minimizing two-qubit depth were of paramount importance, we could actually reduce it a bit by changing the order of the CNOTs. For example, the CNOTs on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>35</mn></msub></mrow><annotation encoding="application/x-tex">q_{35}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">35</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>34</mn></msub></mrow><annotation encoding="application/x-tex">q_{34}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">34</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> could be moved to the left in the circuit diagram above, and could be placed directly below the CNOTs on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>30</mn></msub></mrow><annotation encoding="application/x-tex">q_{30}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">30</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>31</mn></msub></mrow><annotation encoding="application/x-tex">q_{31}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span>, for example. For a two-qubit gate depth of 5, it isn&#x27;t obvious that this will make a difference after transpilation, but it is something to keep in mind. If the order of the CNOT gates is important for logically matching the problem at hand, the depth here is fine. If the order of CNOTs is not critical to modeling the data structure in our images, then we could write a script to re-order these CNOT gates to minimize depth.</p>
<p>We also need to re-define our observable with our larger images:</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">quantum_info </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SparsePauliOp</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">observable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SparsePauliOp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Z&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="qiskit-patterns-step-2-optimize-problem-for-quantum-execution-1">Qiskit Patterns Step 2: Optimize problem for quantum execution<a href="#qiskit-patterns-step-2-optimize-problem-for-quantum-execution-1" class="hash-link" aria-label="Direktang link sa Qiskit Patterns Step 2: Optimize problem for quantum execution" title="Direktang link sa Qiskit Patterns Step 2: Optimize problem for quantum execution" translate="no">​</a></h2>
<p>We start by selecting a backend for execution. In this case, we will use the least-busy backend.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit_ibm_runtime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> QiskitRuntimeService</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># To run on hardware, select the least busy quantum computer or specify a particular one.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">service </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> QiskitRuntimeService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">backend </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">least_busy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operational</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> simulator</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># backend = service.backend(&quot;ibm_brisbaneane&quot;)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backend</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ibm_brisbane</span><br></span></code></pre></div></div>
<p>Once again, we are defining a pass manager, with optimization level set to 3.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">circuit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">library </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> XGate</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transpiler </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PassManager</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transpiler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">passes </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ALAPScheduleAnalysis</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ConstrainedReschedule</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    PadDynamicalDecoupling</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transpiler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">preset_passmanagers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> generate_preset_pass_manager</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> backend</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> generate_preset_pass_manager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> optimization_level</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">pm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">scheduling </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PassManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        ALAPScheduleAnalysis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        ConstrainedReschedule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            acquire_alignment</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">acquire_alignment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            pulse_alignment</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pulse_alignment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        PadDynamicalDecoupling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            dd_sequence</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">XGate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> XGate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            pulse_alignment</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pulse_alignment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p>Now we will apply the pass manager several times. For very wide or very deep circuits, there can be large variability in the transpiled two-qubit depths. For such circuits it is important to try the pass manager many times and use the best (shallowest) result.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic"># Try pass manager several times, since heuristics can return various transpilations on large circuits, and we want the shallowest.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">transpiled_qcs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">transpiled_depths </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">transpiled_2q_depths </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    circuit_ibm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">full_circuit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    transpiled_qcs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">circuit_ibm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    transpiled_depths</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">circuit_ibm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    transpiled_2q_depths</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        circuit_ibm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> instr</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">qubits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># print(i)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">transpiled_depths</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">transpiled_2q_depths</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use the shallowest</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">minpos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> transpiled_2q_depths</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">transpiled_2q_depths</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[85, 85, 81, 89, 81, 81, 89, 85, 85]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[10, 10, 10, 10, 10, 10, 10, 10, 10]</span><br></span></code></pre></div></div>
<p>We see that in this case, the transpiled two-qubit depth was always 10. There was minor variation in the single-qubit depth, and we will use the shallowest one. But on this 36-qubit circuit, this is not a critical improvement. We can visualize this transpiled circuit, although at this scale it becomes increasingly difficult to parse, visually.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">circuit_ibm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> transpiled_qcs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">observable_ibm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">apply_layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">circuit_ibm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">circuit_ibm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decompose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;2+ qubit depth: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">circuit_ibm</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">decompose</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">depth</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation keyword" style="color:#00009f">lambda</span><span class="token string-interpolation interpolation"> instr</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">instr</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">qubits</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation operator" style="color:#393A34">&gt;</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">81</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2+ qubit depth: 10</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="qiskit-patterns-step-3-execute-using-qiskit-primitives-1">Qiskit Patterns Step 3: Execute using Qiskit Primitives<a href="#qiskit-patterns-step-3-execute-using-qiskit-primitives-1" class="hash-link" aria-label="Direktang link sa Qiskit Patterns Step 3: Execute using Qiskit Primitives" title="Direktang link sa Qiskit Patterns Step 3: Execute using Qiskit Primitives" translate="no">​</a></h2>
<p>In order to limit time used on real quantum computers, we will only carry out a few optimization steps here, and we are doing so on a very small training set. But the scaling of this to more optimization steps and larger testing data sets should be clear from instructions throughout the lesson.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic"># This was run on an Eagle r3 processor on 10-4-24, and took 7 min.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> qiskit_ibm_runtime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> EstimatorV2 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> Estimator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Session</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">num_epochs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">num_samples </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Globals</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">circuit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> circuit_ibm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">observable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> observable_ibm</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">objective_func_vals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token builtin">iter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Random initial weights for the ansatz</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># weight_params = np.random.rand(len(ansatz.parameters)) * 2 * np.pi</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Or re-load weights from a previous calculation</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">weight_params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.35330497</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">5.97351416</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">4.59925358</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.76148219</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.98029403</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.98014248</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.3649501</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">6.44234523</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.77691701</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">4.44895122</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.12933619</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">6.09412333</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">5.23039137</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.33416598</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.14243996</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.15236452</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.91161039</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.2971419</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.71399059</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.82984665</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.84438512</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.87646578</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.83559896</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">2.30191935</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">2.86557222</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">4.93340606</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.25458737</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.23103027</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.72225051</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.29185655</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.81731689</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.07143467</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.40873121</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">5.96202367</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">6.067245</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">5.07931034</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.91394476</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.61369199</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">4.2991629</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">2.76555968</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.76678884</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.11128829</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.21606945</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">5.71342859</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.62596258</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">4.16275028</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.95853845</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.26768375</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.43508199</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.1614748</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">6.09207989</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">4.87030317</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">5.90304595</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">5.62236606</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.75671636</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">5.79230665</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.55601479</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.23139664</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.28417144</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">2.04411075</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">2.44213144</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.70493625</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">5.20711134</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">2.24154726</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.76516358</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">3.40986006</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.88545302</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">5.04035228</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.46841551</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">6.2007935</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">4.85215699</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1.24856745</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Running in a session avoids repeated queuing. This is available to Premium Plan, Flex Plan, and On-Prem (IBM Quantum Platform API) Plan users.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> Session</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backend</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">backend</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    estimator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Estimator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;resilience_level&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> epoch </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_epochs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num_samples </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">//</span><span class="token plain"> batch_size </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Epoch: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">epoch</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, batch: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            start_i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> batch_size</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            end_i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> start_i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> batch_size</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            train_images_batch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_images</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">end_i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            train_labels_batch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">start_i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">end_i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            input_params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_images_batch</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_labels_batch</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token builtin">iter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># We can increase maxiter to do a full optimization.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> minimize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                mse_loss_weights</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                weight_params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                method</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;COBYLA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                options</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;maxiter&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            weight_params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;x&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Open users can carry out the same calculation using a batch, but repeated queuing is possible.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># from qiskit_ibm_runtime import Batch</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># with Batch(backend=backend) as batch:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    estimator = Estimator(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#        mode=batch, options={&quot;resilience_level&quot;: 1}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    )</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    for epoch in range(num_epochs):</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#        for i in range((num_samples - 1) // batch_size + 1):</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            print(f&quot;Epoch: {epoch}, batch: {i}&quot;)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            start_i = i * batch_size</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            end_i = start_i + batch_size</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            train_images_batch = np.array(train_images[start_i:end_i])</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            train_labels_batch = np.array(train_labels[start_i:end_i])</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            input_params = train_images_batch</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            target = train_labels_batch</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            iter = 0</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            # We can increase maxiter to do a full optimization.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            res = minimize(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#                mse_loss_weights,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#                weight_params,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#                method=&quot;COBYLA&quot;,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#                options={&quot;maxiter&quot;: 20},</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            )</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            weight_params = res[&quot;x&quot;]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># batch.close()</span></span><br></span></code></pre></div></div></div></div>
<p>It is recommended that you save the weight parameters returned from this computation, should you decide to iterate further.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">weight_params</span></span><br></span></code></pre></div></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">array([3.35330497, 6.97351416, 5.59925358, 3.76148219, 0.98029403,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0.98014248, 0.3649501 , 6.44234523, 3.77691701, 4.44895122,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       1.12933619, 7.09412333, 5.23039137, 1.33416598, 1.14243996,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       1.15236452, 1.91161039, 3.2971419 , 3.71399059, 1.82984665,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       3.84438512, 0.87646578, 1.83559896, 2.30191935, 2.86557222,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       4.93340606, 1.25458737, 3.23103027, 3.72225051, 0.29185655,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       3.81731689, 1.07143467, 0.40873121, 5.96202367, 6.067245  ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       5.07931034, 1.91394476, 0.61369199, 4.2991629 , 2.76555968,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0.76678884, 3.11128829, 0.21606945, 5.71342859, 1.62596258,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       4.16275028, 1.95853845, 3.26768375, 3.43508199, 1.1614748 ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       6.09207989, 4.87030317, 5.90304595, 5.62236606, 3.75671636,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       5.79230665, 0.55601479, 1.23139664, 0.28417144, 2.04411075,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       2.44213144, 1.70493625, 5.20711134, 2.24154726, 1.76516358,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       3.40986006, 0.88545302, 5.04035228, 0.46841551, 6.2007935 ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       4.85215699, 1.24856745])</span><br></span></code></pre></div></div>
<p>We can plot these first few optimization steps, although we would not expect any convergence after just a few optimization steps. These curves have been relatively flat for the first few steps, even using simulators. We should note, however, that the optimization currently has 72 free parameters. This can be reduced by at least a factor of 2-3 without compromising results by, for example, parameterizing qubits with data corresponding to a subset of full rows and columns. Indeed, the parameter space should be reduced before spending more quantum computing time on minimizing the loss function.</p>
<div class="executable-code"><div class="executable-code__code" style="display:block"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">obj_func_vals_qc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> objective_func_vals</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># import matplotlib.pyplot as plt</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">figsize</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj_func_vals_qc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;revised ansatz&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;iteration&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;loss&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span></span><br></span></code></pre></div></div></div></div>
<p><img decoding="async" loading="lazy" alt="Output of the previous code cell" src="data:image/avif;base64,AAAAHGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZgAAAXBtZXRhAAAAAAAAACFoZGxyAAAAAAAAAABwaWN0AAAAAAAAAAAAAAAAAAAAAA5waXRtAAAAAAABAAAANGlsb2MAAAAAREAAAgABAAAAAAGUAAEAAAAAAAAaFQACAAAAABupAAEAAAAAAAAASAAAADhpaW5mAAAAAAACAAAAFWluZmUCAAAAAAEAAGF2MDEAAAAAFWluZmUCAAAAAAIAAGF2MDEAAAAAr2lwcnAAAACKaXBjbwAAAAxhdjFDgQQMAAAAABRpc3BlAAAAAAAAA+kAAAINAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQQcAAAAAA5waXhpAAAAAAEIAAAAOGF1eEMAAAAAdXJuOm1wZWc6bXBlZ0I6Y2ljcDpzeXN0ZW1zOmF1eGlsaWFyeTphbHBoYQAAAAAdaXBtYQAAAAAAAAACAAEDgQIDAAIEhAIFhgAAABppcmVmAAAAAAAAAA5hdXhsAAIAAQABAAAaZW1kYXQSAAoKGSZ+iDOCAhoNCDKENBIAAooooUD0vw0VymWuNUv6ay3yzrz74VXiUc5aTz7/fe25eFkVbeYRLAt25bBOyawAeMPxb+ICdh02dOUjN9ds2P7692aImHZ5/Cu72GTXaLx2CZrDZ7YsrBLIreFn/FzqE3gr9Awdv1VLWLg4SgkRw2cOlB2hFHCwzZkkNqbSUP/3JjmD2o9jiHHLIQZX621oGMro0aLJafTYPEj2CioSWT1z5k53+XWoAWuXwew3KKteQwgGMQPaP+yHDPFnrL5yJSEhVs0zFYUtLMRRg3OANCBGcjr+MXVVoOXopS6r9Jwn+oHefW3okGBI9Q1T/1AxlWOxLhXHGdk8b3UpiyokEAXCgqESN+k5saQ0M/sC9/z2YK1KKcixR4Yo0VWK8iIiTP1zhkrhmnMK55ePdYyzClTCCLAw4IW1PXOz0by3xdDHjpJsiUwwrRmmIb8ZTpVlB9kT/f/pKtZXyaXoccHknSWVIHb4znriEpmcOQ+eOF3Rlckah9hA/oCO1cHYv3CF55AHKB2v8cIZ+PBqjT23sk8baZWEWyQD2rmQ/Gxj9mDiAhlqp6Vl1wv5qa0AlLUckAdCkjd2haFLAkfigw6dzRvkvncgsOqn4EHJXx0kLF8Z8o4Y+vw5tnC43833KPH60PpOVJI2hudVx+rGvHhnXU8+ukE/UR4W+BMpHTnq7tTzz8sNl9ZgDvKvlc4aALszfFEwI5ZhOxC3XmWVVBekyF12IckKJpHvoIVgXMGAkrBxzDEq3Vqmj2KbKGc6B3TAKxoOwE0V/TDRim0Fxj8bHXHBt+/z2P/CzH/ILY9pPEFM+G1zQMgQ3VB4N02i0ct5kdMjaaFlsdEhle6bDUbkfwFvvUu3PiRB9EgCo1BoHMTAaBWmYz1yqiwQUV5YBdiBFtAVrl3xMIbihgY91yKiEobbJRM7BDJ3iHqOO2cWj17zdbM0OC0uSeVw3MmwyW+Hxq6KN1iHHdDugweRo7901C0DX0S2T+TxeA27bHI70KLc5vqIWu3AryksV4dKcwqDPXpLE1D8ZDMIjcsjPXBuAGgryPXiRdQOpuvFmBHveiVSkEQC25OpQMXkVjS5TX6PxVieYLSVliMswlrq6My4HD+rasGs/p8XhshIWulNHBUvCK3RZNSv56S7MAhUmXbbj59VTVmh3HHVYIAo459H3BjcqLHf4YvP8atCoR+J0u1b2EUO/cSV7WFxRLh/glx3+93AAQU4nVG6HzAcFkz0zk3IzyDcnFKGD7CipkqPhgeq5Q3ASXam5IdcSjrpyEdWDelODJWZ4+EYfuvpSImjrKa1SAzvCIU+VD1mEV/K6ViQ6xLQFcJEhjWZbsMcAbmgT4NiBgbMsj+XL+7nhH8dgvOaTRqkR9w/cm6N5SSZiZwfXuKQ0AMx7ogeK9zfuSm2NHibe3wU7SpwvqK6kSlhakCAxvG72UeA+zv02vSEKLI+r3ciWkmKoqpHOM14oHkgQoRmhCm5c+D+e0gLDxP3QK5q22dfO3g2JKv00M6Ts6ENRdTxblKlo7fmbSl5XxYqJfvFJkqtmjGTFR3foJGCNweSuhgnTCZM4Prp28Qsr5LoOW4dCuz8Bmu+pQTmzAlqboFQ77Ts6A85NXMLN/fxNkIAZxV1yQ4/szYbUvBZJ97FKXlJbe4P3NjXHb7qUb0knoCOHqdy9gTBONdVBuDfFo4KihJMq1e4Q+VKgpbFwsRH5Z3d1TBQrHru7PQA69YO4v78LoyxtUGSZxAslrX1iZS6QqPtgJG+i29vdiranR+/WTBPz2jMfr2r7gymvvzzrfrwqVRGSze1CZs2ivOodtlGXnALJ2c+iqUxBJnENY+yxTwPSnfcnAAPKTPFn+oXUELmytONu/7KQMPv2HLroxhfChdiNk4J+QPdqOMJWER8U48JBlZx0trAZ5oM2JhYGl05t0B2QPKmIOnahrpQ6xzRh1hmqxKF4NLtFuCro5ZHjE+QE8DtBS+htDIjfwnfHIeByUwHa7/nVKTD5elmrBaf3NTx6lkVd1OlBTY/ZzGZrmq6svLeYVu6RmOX0JYqEUSMO73azzuefrMSaQySPSB6s0O1sSJEyjPCJLMbLiIDdAWW2/I1/Il7YwxK2Mys4al19CEEEzchROAgCJJ5XZWHb5RLSguqs8QA6NdLjxPyBmT/QjGJ9slIOgLBmWd1Wn4+ZSN+2DVf3yKwyfWEbVg8dEvje8RywYj52KUemxw3qldB5Bhz5Xw38uKSsKhZP7bGYsZ/R2+Mb6CyVi47SFbqgvhP/gzB5m3vGMlrkOub40P79k9tA1wU5xuaHu3fGOxPZ1e4mC+v5KdNAO9FerNe8WmhsuNbHP5psYDi87PkosG4mDiU9z4uaWG2tDVDu8z2364vXWQTNktRvTjgv3mXqQFxzzyZXX9Y7gKyO9x6rh0qum8jn+7NZAEok9UlUhRx1stj7NyLhjAQcNe3tS/e3Rrz5BDxdQ0tJIVBjnEF50c8EZk9t2JgzJdEW6m1oU4dhY1DzeWxN/BVXUGNYn7y3WYhgukhkIytHlmSZC2emSlg8enCAn3dQmEktyK+DS3OANXiKSpCelZWpN+K+mqwgS+sg2YrLbmspcQRdDISikgZhBSJyhacleIQVSpRc0kEa5SEY6Ys+Yj4dlcEUA4HQfFFGm40uZ/K1KwVy6aETmZVWXenwzqkPpEg4Hf2c37PUmFJkCn6dRHve8Xak8Dnc789mzQBOhIqBXFA4dydpYF/W9l4Axg7PGYSH/HWCbObOfVpOI+KqBN0LWDcZyfDHqalOHn/7rCUn6DQ6/MvlQcHfTequKQ7GtAqfz1kr+L1NZRLI4apd71xBR5/SskkM1nNg9g2lR6iHoSFNI5g+x+GKWY9AWJe/rD/embn3bbAzrh3PZX/Vc0izgrnGs3dPjXJnaSEdR9UXaV4LAqaUPfZkoCtfrO4Y6ZPBPdeGghuMcTfr3uNavsAhm1qIgizft9zQvR8tXoVhd64t/1KAfvvmCOh/2AH28CyHLQvZM1C2xbrvIZuVwjxaxF/a1h4TGHFe4o9dK8T1HQXCRd6LDWbCZ/l3NIw15m9uIsTev5+q2Y3YvaG8h55s1o2D60D6/lc9XtBX4QuXdi6dpinhAMLzhRqYaEixaInHqqIjcPEBjmFBw6nH/srnLr+D9D2Zmw9p7iR8TyJPXnlZu573vLP8y6eJIruo59vBtON/s6vhfSxT5AyysrIpdmmy04jC88VcW80QU34WDUhJD5NNuq9cnIIAOPPU2hgkMZghXezWL9mzDBiOQyyT5AUmsGOJ1rRBzR7FqqXPI9bktMP0P5M1smjAOpK73TWH5ujeYlhsQJljbD4gC21Im/OOVSIYsVUE7o2FbRJilRVIIPEMitbqzfZu1w8nSF58gcvyy8WwkqEzOqrczVzVqY3cOlvmQ1w6KyYTVkkIZO0U3bVwtSYxsPqnPmXq+ZaB3Q53eE6KLCV6qkAP58ghF3MElBpVkWLhykJ0a3g7Rom+1f/nwlL5t9thLt9dj7QWHqmwyxXprgALgo1kz9Rkpp06l5w/MzE9kzDXilVEuI65eWpKeAASPJ4acF/75dqvCAtV0v8R7dO2p9AssaqmetUeCNEs1WdNKzMdF32wMZLNQ4pIRA70kBI11HK+NxGeHdJMZh1GprQCc6e41w6NojpVYFX6fJrFei0g4cPjIm+NlV5C/IFS+t1HZL+PJ6/MtphG1Du94huW/6H81NZs7Brws8lc5HmDeVfgtuJzsb/frUs9DHScKBElMcsxiIh1CTtidh1uViGinkRilje8X2CMj/X6OaP0ugDj8HSYTzfMk/SrkjfmlxjhYcYM38w8PXj3hkkbOfTnQd2GrVezmF5hxgQobbyDCrp128foJPCCuLipkbxT9FvFF4NvBf+sMomqFhwzFRpDjbrFId05olgRrJiQppG9m67OMNvUA2cyy2lxNDQ+p21jHXcDhpn23+c/TG2zZ0YRazVLVZ8Q9WrR5DmSqD7TDb7ZcY37Fcv2ITpUvSNm0XVVgJhTUx8abj2sQs1fRHXtY8dLilXWn3EjzquCIXFPM1vnkROhEvlUQJrGOFa0iSen6O+UKwLwmcv03YsQ4utSEmsAj1vvQP8xl+z6s8ZuWyRcNzhqu3VcP5ICELdinYOCU9eaFFTe15Ak+XMZ9dp5b+15M9QzI/PnO43zk6lTaWFsSDMdQrV6sSbiL64I6PAevP17MLrrwXd0Ub5zzbqBMe30pNlOIcwuAnWqfnHCmlbPk+oSyvgxh89M+Xf+zsqJFLQB80c27Po63rg9rTQutkmLLvZ4WgKUOx2l4d5xlUGENHYG0hovuRRp1poZ9AaRdP4wREm4bpjLKU2j50Jz+G6DSD8QKKB+JiTYoCUCbqV6reFpoxBrXGp3i1Z0Pkn0se0KhM8IFkut2LrvEDC0awDZp+fwYSQudcH9ZoA3bb7m6g/imoq3/1123OfIsMMNjuoh9Ru/dtRMHNuHBPbFAwK2Kpiq7LNw+eNSCMepKseWS10MrgYzotzcXFKJVTJ3YhjmdBQmw4236AeyvIbGkFC6XCVKqMoGTlnSoOfsfKNXMnCpkzMbkK0f/vO6qvnGf/FvTpQCFSH8W8ikulb/Gzz/jx+JrRasiqM9C86Shkfxoz80tS2HbwkRD/Y6ouOdNfuM1HnT7QSGPysuW6PwthCu3itrzPqsA5tDBNVXv9YYG7E/uVs+HU9icYslLgMlKJVQpwP4c7qlkZCrAYiDWbZ8lIPhvHNhb88IfEiVLvjkE1WufVJ5h9VJCgh+z10thuhjXgu1ITjomD2tB8l0vhh3Zgmn7QN8ZsQcK9UFsRVTbs6l/yGq/J01w5y1pOlTAOz9wnr2r9Por6iq43ra5/q2rIhYrVmwwqzZvN3RcmLZihKeZxflWcNEvxPPfr0A6/l1FufjrN7D+oBrzR5BGYmI/QmORrHbLY01jZyO9NlU0qqknl05wh1vZl/SFnowuzirTtnXTtfimvCnKuuJp1U+ikrwP4MqH+L2GEADoLRdtc71qULkUxCSZW0l0vm3y9qRCETUxz+QrZgZhkzOXhbmK2ckgWP6LBd6oCYWDJMksMKRkcTFfOuFpeE9MmBaOBhmD7iR4SH8qNJX8SpZILRAHquRLqlniYtOre49+iGxb5I09+Ixge49eYX86U1ehVwuGL1+L+sxuLBFN9QWCRQj1qc4hpoObOk7nM7KTaXNcxHzPskgK28o/8hu+2Nh8PTlnxDQwns+xMOY/U2w9SQq63o5d3uA4cY+PUB3MyD5jhWYM8SO0JnF2GGg/BWI8+aCas+sOwGEh8oJGI67aos/+cEj1Zz+iUOuOmlNPgD6ySj53M1Cg2zRUKiXwVGQHuttIu77zkDVgX4HYuIlSiY5prJqTVAbL1LA08al7Q5kJTiPloqEUH9T8dG2VnrabvH5kVe2MCD4EWVFAnwfMgTTeX0ErOeTnN8EyAUvCCaBoYBikTr/poPvHaVRHidjsNScGzbXzviYSwXlLimOeWPXgX9PtAKz+/n4PEiS3ifOvd3yKuB7g3MCsrZtPMvVah7jR5xWDRPdHLHPATdA8a9yIvRhik5ufGgAt31YRQJMgkt7lLwK4+erCqIjPWdBGIgv0sXyGEM6ILLagDzpsd3U4JRWyBi69zAswVT3YOUifmdYDZd3nZjtRg4ojdTwsauzXdUbIHVSIyT0D6Rw8EvV9HOXYlUjW209wB5gBiAeOU2xLM5mZr5BEssLg+sOKhVKvEo4VwqDnrRo2qNTvHnhM0ZhREvWhKgNwTIf6/aeaxT2ZgXkZtt9fE+trv+8M9IA35e2fC39j6Cdtq8odZ3d9X5Mz/CJCooypD/b/VXCqomDYZX6lneBybHBbQZ+upFKAnQSIUB8PvHQeXeoiq77Z2ye0ppyA0O4Hiam9MhrkNuPGgemzGdEFtc/74dlvezRlxGrnK158teCkfchNKNkUMz42Hu0K7Up88qM53i/PaQcgWnIlp6xG8gICeYcU3hI8D+jHnhHglDAbg+AHr8Oh+pbVehMov1IxgOjwRkRyvSOPsFTw9oIk577arLoXkeJHSCkRZ1WQdtrfD5F9uq6uow32GI4pId26lauNA3VkMEa2s8bp46Eee4D1rwbOjPUYsfDZxsTJMOzc0WgT5vsgq+fi8vNz5c11hUFAv+K3XPPmGMYOf/1lS2Sb75axvPaU+WxAa1LUU/fRYw5k/SPkF7WH33Lki1gxTOOjB2Er5EpouI0gxOeQf1+6vdlG4FW+Z6pntzLVYbjbIfkHAipS93P9cw7qRVtKJhTCUl1u7zyYiC1DwOSa1Zzhm2br9awbSC4CMV4kAbn6D9NgPadFegAD42WgWpVHVjh+ZDiLJsKQzyCyOpBZNgFZDmF3SDDFSDEJ7qCAGHxP6mHX/wd8QEbiT3hvRYSBTBEBS03f6io4g3ZrGa6QQfB7OPKxCnsWr+B6drvG893q3e8VQO8kvheWdk9KTE5a+AkgLKoS6GRdHbqpCLymgPAawAi7055ut928ZxuIAy4TDC/6w+FeJOTfrbNkB5QQjSKqeky+6Frn443FH1ncovq4iMsjiin1wwZeUilue7N+jY7CDZJc5gpZ1M89vTDSiZfArWIi8JEwFNaamqrq4/ug8AwMbbvn66aY7UK3Z03u2gze8a5Fa7NQFAb30UgyrDnNFfLOJKVbElTd9lIL6YHNGCdA+QrnCImVeETSIDldvDIt1zebLmmr4I7QDtSUouFrRDxtExcXV8r9RpIYILFywwR0zYHgenx/Rjs418SvbkgfeuqiO8O2omCM66VP+LRndC6hI0+5DfT/I2AaJjJir8/qIYkoVgwieLEw/3uaxPf2LJpc8u4u6iSKeQM2c7ruxm1BgARvvwcg1y3y3LIqLrUjAVcpX4/KN7CN8ELmo+0vvRSI8mM9xctIiNGD0E6FlUW8mFztLl2KZ5Yz8ffvOhmSpIc0hjjf732YdGY3KPMuBXnPXvZ3UsTkC7Kp9emHZomDl/ElIZIENduIlVrVGP2zt8gAZ027FCKItnLRhY0Sm5ihmOK8roqRhLxjQ88qMvjRDF0xNYdbsJBiX+v1jXDOQRG0ClArOL3lElWrgnlZ5R7hbNDUOgFRt7Haaw7oPIYiwZA+5uyOQPdI0r035cigXEv0bpcTjzTSpbkr5sflmK9cyZi/Qn6/AMbVEd2ZeMjtB8KrmLKNqr8kxSbzIFD0T6dCbb6acZslm70Hr/fHk540CItwUoG1EJMFdnFf5lQ/bu+2zSJeMjdqFqGdlIiDuGEZYq9ZRC/5gjH/7uPwHhjaWO6139QONThQk3Xlt4okXgdxZadVaPunAfrK6Iq8LXe9YEnSDTwjOEEMo7LC33iEr9sufeXvjNqkkpEzjRp/GBjV8iKRCURREBW5kjB/qzcJeazJo1TOyyip1z058AUTTNJDIye6/QAQXvEUNTd4OSosZ0VScC4LKxr88EXh8vDAUxEW4Vyhbf127vmrhdu9RQrxjqLTVOjiUsAli9m83LRWpdlaQVPWTGADrV+4uYYvlfL4vf5a78iOHaw0iMbvUlwPCWTLMF6eZAUuP+HHVCL/VbPRv+cyeIGkUy8jquTXEOYIK0FKuXkUVnI2QG7NZo3/riK5Z9jP2o9YhNrGOaqAgIMumtJNyunhPYl8tmTlUwsthz4idvHA0O77niwhcF4JcuAwKRqz+ux//gbqxduk/3vOQ7LZ7zmcv26jPEp0QEMHG4J8MUT4f5Lvq1ftB206+1lu/zkcN8+/J4VD2eCfK6zxFb/vkGMFo4bhaCIUzzO7GjIDNrixnVdrcGinmqblimJTLImM+SwzHbsTbrLs76Urs7HKpVj/flTYkA5RXi2FMauvNhw+c6RKdWh7HvqpEtx+19BgS+8aGrAxquo9BkwX9Intb8S3TLCIFAHNGUYs53vV2LhucjZia5fyfdOdi/Fm+pZqqpAbDVD5V1U5x+RL9e12Ott0PQnUqqwlhPVH8OCLJjsA6wDN22xHg5eN64E5Ef5xOzcnVloiHJDnwZOVHjq56E6ApNkNMmckLbPh1HY7J+9HWdz4GD252JeiEzJ7hyJPv+kVRr5wMGl9YxXOgjWZjvFEdupSeIwyPBOntuNxZ8OHxbmsKaDm+pnp4a2eUcLXYk2ODHjTIfsjr60c65v7CG6S4pKu1PeVx2SXL3jH4rr0yNSCvM4ulzsv9xJPe5lt7XjTAX6isC8ZWC02uhx2/rZZMgs5goJbHP/C1fsvZf0hfH5zCnBMGJBiVG4JRjQ9o/JQ4BsdZ+OcU6pUrcxkCroIzXuhMoSunVzOVxlw49ovRQ0W473brOeAr40gyTngOeXXX5SowK1gIOOGKYSUB1vonqO222YwgPQYp94apmSUiCP2N0DIos580FCqQjK6pGCT6um0VPkMzIMAmqBPYsvz4CCmM/E5oM2XGI5aUQ/uwMsV61JPwxPlT2f84WMUdI+WBNN+BRyFL9tkCbPOdSsINK8G63nDKZg+ct1qHAGZzEEPJFxTd59fYXGRhTRHFlaPT6MO7Ij7wrV6jRXjzZ/8A1RbBt8Qc71uJemW4hsQp8sIcAPZ8agtp5am/TLTCdHfWrAdoKHkwjKaqXO6tU0YQ0lxNb7EOwcDYDU9QghnZNg/r+EBYYezZ/8T7XEbIyyFZOE0UUFQ0O92cwzaNkQVDunmKELli0539QoRSW4t2BXvB3qKy9X5seWjiZtidgL4er/56lVyrJOGGlqHQAT5T8K9wtke2NfG8zkr59sf+6oHQ45Eu+yi6UhZAGZlzehvw5x0w4nltISTpWWkV9HKb/Kh3spBpCw7oU8xL8rycSJRil+3U75xwOQZIuuZtftiT1EjyEi5Hflk1ZcBIACgcZJn6IM4VAMjsSAAooQPTwEN2wJ26dUK7I2D7vCvHM9JlNnGEDknlgxtef8dCea0Bc8NwrMO2ecUSMJaIxiFX1WsCNTA==" width="1001" height="525" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="closing">Closing<a href="#closing" class="hash-link" aria-label="Direktang link sa Closing" title="Direktang link sa Closing" translate="no">​</a></h3>
<p>To recap, in this lesson we learned the workflow for binary classification of images using a quantum neural network. Some key considerations in each Qiskit patterns step were:</p>
<p><strong>Step 1:</strong> Map the problem to a quantum circuit</p>
<ul>
<li class="">Load training data. This could be done &quot;by hand&quot; or using a pre-built feature map like <code>z_feature_map</code>.</li>
<li class="">Construct an ansatz containing rotation and entanglement layers that are appropriate for your problem.</li>
<li class="">Monitor circuit depth to ensure quality results on quantum computers.</li>
</ul>
<p><strong>Step 2:</strong> Optimize problem for quantum execution</p>
<ul>
<li class="">Select a backend, often the least busy one.</li>
<li class="">Use a pass manager to transpile both the circuit and the observables to the architecture of the chosen backend.</li>
<li class="">For very deep or wide circuits, transpile multiple times, and select the shallowest circuit.</li>
</ul>
<p><strong>Step 3:</strong> Execute using Qiskit (Runtime) Primitives</p>
<ul>
<li class="">Carry out preliminary trials on simulators to debug and optimize your ansatz.</li>
<li class="">Execute on an IBM® quantum computer.</li>
</ul>
<p><strong>Step 4:</strong> Post-process, return result in classical format</p>
<ul>
<li class="">Calculate model accuracy on training data, and on testing data.</li>
<li class="">Monitor convergence of the classical optimization.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="references">References<a href="#references" class="hash-link" aria-label="Direktang link sa References" title="Direktang link sa References" translate="no">​</a></h2>
<p>[1] <a href="https://arxiv.org/abs/2405.00781" target="_blank" rel="noopener noreferrer" class="">https://arxiv.org/abs/2405.00781</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><div class="dq-edit-bookmark-row"><a href="https://github.com/JanLahmann/doQumentation/tree/main/docs/learning/courses/quantum-machine-learning/qvc-qnn.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>I-edit ang pahinang ito</a><button class="dq-bookmark-button" title="Bookmark this page" aria-label="Bookmark this page"><span class="dq-bookmark-button__icon" aria-hidden="true">☆</span>Bookmark</button></div></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Mga pahina ng dokumentasyon"><a class="pagination-nav__link pagination-nav__link--prev" href="/learning/courses/quantum-machine-learning/quantum-kernel-methods"><div class="pagination-nav__sublabel">Nakaraan</div><div class="pagination-nav__label">Quantum kernel methods</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/learning/courses/quantum-machine-learning/exam"><div class="pagination-nav__sublabel">Susunod</div><div class="pagination-nav__label">Exam | Quantum machine learning</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#data-generation" class="table-of-contents__link toc-highlight">Data generation</a></li><li><a href="#variational-quantum-classifier-a-first-attempt" class="table-of-contents__link toc-highlight">Variational quantum classifier: a first attempt</a><ul><li><a href="#qiskit-patterns-step-1-map-the-problem-to-a-quantum-circuit" class="table-of-contents__link toc-highlight">Qiskit patterns step 1: Map the problem to a quantum circuit</a></li><li><a href="#loss-function" class="table-of-contents__link toc-highlight">Loss function</a></li></ul></li><li><a href="#qiskit-patterns-step-2-optimize-problem-for-quantum-execution" class="table-of-contents__link toc-highlight">Qiskit Patterns Step 2: Optimize problem for quantum execution</a></li><li><a href="#qiskit-patterns-step-3-execute-using-qiskit-primitives" class="table-of-contents__link toc-highlight">Qiskit Patterns Step 3: Execute using Qiskit Primitives</a><ul><li><a href="#loop-over-the-dataset-in-batches-and-epochs" class="table-of-contents__link toc-highlight">Loop over the dataset in batches and epochs</a></li></ul></li><li><a href="#qiskit-patterns-step-4-post-process-return-result-in-classical-format" class="table-of-contents__link toc-highlight">Qiskit Patterns Step 4: Post-process, return result in classical format</a><ul><li><a href="#testing-and-accuracy" class="table-of-contents__link toc-highlight">Testing and accuracy</a></li></ul></li><li><a href="#improving-the-model" class="table-of-contents__link toc-highlight">Improving the model</a><ul><li><a href="#step-1-revisited" class="table-of-contents__link toc-highlight">Step 1 revisited</a></li><li><a href="#step-2-revisited" class="table-of-contents__link toc-highlight">Step 2 revisited</a></li><li><a href="#step-3-revisited" class="table-of-contents__link toc-highlight">Step 3 revisited</a></li><li><a href="#step-4-revisited" class="table-of-contents__link toc-highlight">Step 4 revisited</a></li><li><a href="#step-1-map-the-problem-to-a-quantum-circuit" class="table-of-contents__link toc-highlight">Step 1: Map the problem to a quantum circuit</a></li></ul></li><li><a href="#qiskit-patterns-step-2-optimize-problem-for-quantum-execution-1" class="table-of-contents__link toc-highlight">Qiskit Patterns Step 2: Optimize problem for quantum execution</a></li><li><a href="#qiskit-patterns-step-3-execute-using-qiskit-primitives-1" class="table-of-contents__link toc-highlight">Qiskit Patterns Step 3: Execute using Qiskit Primitives</a><ul><li><a href="#closing" class="table-of-contents__link toc-highlight">Closing</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">doQumentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/features">Mga Tampok</a></li><li class="footer__item"><a class="footer__link-item" href="/jupyter-settings">Settings</a></li><li class="footer__item"><a href="https://github.com/JanLahmann/doQumentation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(magbubukas sa bagong tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">RasQberry</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://rasqberry.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">RasQberry<svg width="13.5" height="13.5" aria-label="(magbubukas sa bagong tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/JanLahmann/RasQberry-Two" target="_blank" rel="noopener noreferrer" class="footer__link-item">RasQberry GitHub<svg width="13.5" height="13.5" aria-label="(magbubukas sa bagong tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">IBM Quantum &amp; Qiskit</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://quantum.cloud.ibm.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBM Quantum<svg width="13.5" height="13.5" aria-label="(magbubukas sa bagong tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://quantum.cloud.ibm.com/docs/en/guides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dokumentasyon ng Qiskit<svg width="13.5" height="13.5" aria-label="(magbubukas sa bagong tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/Qiskit/documentation" target="_blank" rel="noopener noreferrer" class="footer__link-item">Qiskit Docs GitHub<svg width="13.5" height="13.5" aria-label="(magbubukas sa bagong tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://qisk.it/join-slack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Qiskit Slack<svg width="13.5" height="13.5" aria-label="(magbubukas sa bagong tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Ang nilalaman ng <a href="https://github.com/Qiskit/documentation">Dokumentasyon ng Qiskit</a> © IBM Corp. Ang code ay lisensyado sa ilalim ng Apache 2.0; ang nilalaman (mga tutorial, kurso, media) sa ilalim ng CC BY-SA 4.0.<br>Ang IBM, IBM Quantum at Qiskit ay mga tatak ng IBM Corporation.<br>Ang doQumentation ay bahagi ng proyektong <a href="https://rasqberry.org/">RasQberry</a> at hindi nauugnay, sinusuportahan, o sponsoran ng IBM Corporation.</div></div></div></footer></div>
</body>
</html>