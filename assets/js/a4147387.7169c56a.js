"use strict";(globalThis.webpackChunkdoqumentation=globalThis.webpackChunkdoqumentation||[]).push([[6058],{74980(e,s,r){r.r(s),r.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"guides/serverless-first-program","title":"Write your first Qiskit Serverless program","description":"How to create a parallel transpilation program and deploy it to IBM Quantum Platform to use as a reusable remote service.","source":"@site/i18n/tl/docusaurus-plugin-content-docs/current/guides/serverless-first-program.mdx","sourceDirName":"guides","slug":"/guides/serverless-first-program","permalink":"/guides/serverless-first-program","draft":false,"unlisted":false,"editUrl":"https://github.com/JanLahmann/doQumentation/tree/main/docs/guides/serverless-first-program.mdx","tags":[],"version":"current","frontMatter":{"title":"Write your first Qiskit Serverless program","sidebar_label":"Write your first Qiskit Serverless program","description":"How to create a parallel transpilation program and deploy it to IBM Quantum Platform to use as a reusable remote service.","notebook_path":"docs/guides/serverless-first-program.ipynb"},"sidebar":"tutorialsSidebar","previous":{"title":"Introduction to Qiskit Serverless","permalink":"/guides/serverless"},"next":{"title":"Run your first Qiskit Serverless workload remotely","permalink":"/guides/serverless-run-first-workload"}}');var t=r(74848),i=r(28453);const o={title:"Write your first Qiskit Serverless program",sidebar_label:"Write your first Qiskit Serverless program",description:"How to create a parallel transpilation program and deploy it to IBM Quantum Platform to use as a reusable remote service.",notebook_path:"docs/guides/serverless-first-program.ipynb"},a=void 0,l={},c=[{value:"Example: remote transpilation with Qiskit Serverless",id:"example-remote-transpilation-with-qiskit-serverless",level:2},{value:"Set up your files",id:"set-up-your-files",level:2},{value:"Get program arguments",id:"get-program-arguments",level:3},{value:"Deploy to IBM Quantum Platform",id:"deploy-to-ibm-quantum-platform",level:2},{value:"Next steps",id:"next-steps",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Admonition:r,Details:n,OpenInLabBanner:o}=s;return r||u("Admonition",!0),n||u("Details",!0),o||u("OpenInLabBanner",!0),(0,t.jsxs)(t.Fragment,{children:["\n",(0,t.jsx)(s.admonition,{title:"Hindi pa naisalin",type:"note",children:(0,t.jsx)(s.p,{children:"Ang pahinang ito ay hindi pa naisalin. Nakikita mo ang orihinal na bersyon sa Ingles."})}),"\n",(0,t.jsx)(o,{notebookPath:"docs/guides/serverless-first-program.ipynb"}),"\n",(0,t.jsxs)(n,{children:[(0,t.jsx)("summary",{children:(0,t.jsx)("b",{children:"Package versions"})}),(0,t.jsx)(s.p,{children:"The code on this page was developed using the following requirements.\nWe recommend using these versions or newer."}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"qiskit[all]~=1.3.1\nqiskit-ibm-runtime~=0.34.0\nqiskit-aer~=0.15.1\nqiskit-serverless~=0.18.1\nqiskit-ibm-catalog~=0.2\nqiskit-addon-sqd~=0.8.1\nqiskit-addon-utils~=0.1.0\nqiskit-addon-mpf~=0.2.0\nqiskit-addon-aqc-tensor~=0.1.2\nqiskit-addon-obp~=0.1.0\nscipy~=1.15.0\npyscf~=2.8.0\n"})})]}),"\n",(0,t.jsxs)(s.p,{children:["This example demonstrates how to use ",(0,t.jsx)(s.code,{children:"qiskit-serverless"})," tools to create a parallel transpilation program, and then implement ",(0,t.jsx)(s.code,{children:"qiskit-ibm-catalog"})," to deploy your program to IBM Quantum Platform to use as a reusable remote service."]}),"\n",(0,t.jsx)(s.h2,{id:"example-remote-transpilation-with-qiskit-serverless",children:"Example: remote transpilation with Qiskit Serverless"}),"\n",(0,t.jsxs)(s.p,{children:["Start with the following example that transpiles a ",(0,t.jsx)(s.code,{children:"circuit"})," against a given ",(0,t.jsx)(s.code,{children:"backend"})," and target ",(0,t.jsx)(s.code,{children:"optimization_level"}),", and gradually add more elements to deploy your workload to Qiskit Serverless."]}),"\n",(0,t.jsxs)(s.p,{children:["Put the following code cell in the file ",(0,t.jsx)(s.code,{children:"./source_files/transpile_remote.py"}),". This file is the program to upload to Qiskit Serverless."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"# Added by doQumentation \u2014 installs packages not in the Binder environment\n%pip install -q qiskit-serverless\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'# This cell is hidden from users, it just creates a new folder\nfrom pathlib import Path\n\nPath("./source_files").mkdir(exist_ok=True)\n'})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'%%writefile ./source_files/transpile_remote.py\n\nfrom qiskit.transpiler import generate_preset_pass_manager\n\ndef transpile_remote(circuit, optimization_level, backend):\n    """Transpiles an abstract circuit into an ISA circuit for a given backend."""\n    pass_manager = generate_preset_pass_manager(\n        optimization_level=optimization_level,\n\t\tbackend=backend\n    )\n    isa_circuit = pass_manager.run(circuit)\n    return isa_circuit\n'})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"Writing ./source_files/transpile_remote.py\n"})}),"\n",(0,t.jsx)(s.h2,{id:"set-up-your-files",children:"Set up your files"}),"\n",(0,t.jsxs)(s.p,{children:["Qiskit Serverless requires setting up your workload\u2019s ",(0,t.jsx)(s.code,{children:".py"})," files into a dedicated directory. The following structure is an example of good practice:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"serverless_program\n\u251c\u2500\u2500 program_uploader.ipynb\n\u2514\u2500\u2500 source_files\n    \u251c\u2500\u2500 transpile_remote.py\n    \u2514\u2500\u2500 *.py\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Serverless uploads the contents of ",(0,t.jsx)(s.code,{children:"source_files"})," to run remotely. Once these are set up, you can adjust ",(0,t.jsx)(s.code,{children:"transpile_remote.py"})," to fetch inputs and return outputs."]}),"\n",(0,t.jsx)(s.h3,{id:"get-program-arguments",children:"Get program arguments"}),"\n",(0,t.jsxs)(s.p,{children:["Your initial ",(0,t.jsx)(s.code,{children:"transpile_remote.py"})," has three inputs: ",(0,t.jsx)(s.code,{children:"circuits"}),", ",(0,t.jsx)(s.code,{children:"backend_name"}),", and ",(0,t.jsx)(s.code,{children:"optimization_level"}),". Serverless is currently limited to only accept serializable inputs and outputs. For this reason, you cannot pass in ",(0,t.jsx)(s.code,{children:"backend"})," directly, so use ",(0,t.jsx)(s.code,{children:"backend_name"})," as a string instead."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'%%writefile --append ./source_files/transpile_remote.py\n\nfrom qiskit_serverless import get_arguments, save_result, distribute_task, get\n\n# Get program arguments\narguments = get_arguments()\ncircuits = arguments.get("circuits")\nbackend_name = arguments.get("backend_name")\noptimization_level = arguments.get("optimization_level")\n'})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"Appending to ./source_files/transpile_remote.py\n"})}),"\n",(0,t.jsxs)(s.p,{children:["At this point, you can get your backend with ",(0,t.jsx)(s.code,{children:"QiskitRuntimeService"})," and add your existing program with the following code. The following code requires that you have already ",(0,t.jsx)(s.a,{href:"/guides/cloud-setup",children:"saved your credentials"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"%%writefile --append ./source_files/transpile_remote.py\n\nfrom qiskit_ibm_runtime import QiskitRuntimeService\n\nservice = QiskitRuntimeService()\nbackend = service.backend(backend_name)\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"Appending to ./source_files/transpile_remote.py\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Finally, you can run ",(0,t.jsx)(s.code,{children:"transpile_remote()"})," across all ",(0,t.jsx)(s.code,{children:"circuits"})," passed in, and return the ",(0,t.jsx)(s.code,{children:"transpiled_circuits"})," as a result:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'%%writefile --append ./source_files/transpile_remote.py\n\nresults = [\n    transpile_remote(circuit, 1, backend)\n    for circuit in circuits\n]\n\nsave_result({\n    "transpiled_circuits": results\n})\n'})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"Appending to ./source_files/transpile_remote.py\n"})}),"\n",(0,t.jsx)(s.h2,{id:"deploy-to-ibm-quantum-platform",children:"Deploy to IBM Quantum Platform"}),"\n",(0,t.jsx)(s.p,{children:"The previous section created a program to be run remotely. The code cells in this section upload that program to Qiskit Serverless."}),"\n",(0,t.jsxs)(s.p,{children:["Use ",(0,t.jsx)(s.code,{children:"qiskit-ibm-catalog"})," to authenticate to ",(0,t.jsx)(s.code,{children:"QiskitServerless"})," with your API key, which you can find on the ",(0,t.jsx)(s.a,{href:"https://quantum.cloud.ibm.com",children:"IBM Quantum dashboard"}),", and upload the program."]}),"\n",(0,t.jsxs)(s.p,{children:["You can use ",(0,t.jsx)(s.code,{children:"save_account()"})," to save your credentials (See the ",(0,t.jsx)(s.a,{href:"/guides/cloud-setup#cloud-save",children:"Set up to use IBM Cloud"})," section). Note that this writes your credentials to the same file as ",(0,t.jsx)(s.a,{href:"https://docs.quantum.ibm.com/api/qiskit-ibm-runtime/qiskit-runtime-service#save_account",children:(0,t.jsx)(s.code,{children:"QiskitRuntimeService.save_account()"})}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"from qiskit_ibm_catalog import QiskitServerless, QiskitFunction\n\n# Authenticate to the remote cluster and submit the pattern for remote execution\nserverless = QiskitServerless()\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Qiskit Serverless compresses the contents of ",(0,t.jsx)(s.code,{children:"working_dir"})," (in this case, ",(0,t.jsx)(s.code,{children:"source_files"}),") into a ",(0,t.jsx)(s.code,{children:"tar"}),", which is uploaded and cleaned up after. The ",(0,t.jsx)(s.code,{children:"entrypoint"})," identifies the main program executable for Qiskit Serverless to run. Additionally, if your program has custom ",(0,t.jsx)(s.code,{children:"pip"})," dependencies, you can add them to a ",(0,t.jsx)(s.code,{children:"dependencies"})," array:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'transpile_remote_demo = QiskitFunction(\n    title="transpile_remote_serverless",\n    entrypoint="transpile_remote.py",\n    working_dir="./source_files/",\n)\n'})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"serverless.upload(transpile_remote_demo)\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"QiskitFunction(transpile_remote_serverless)\n"})}),"\n",(0,t.jsxs)(s.p,{children:["To check if it successfully uploaded, use ",(0,t.jsx)(s.code,{children:"serverless.list()"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'# Get program from serverless.list() that matches the title of the one we uploaded\nnext(\n    program\n    for program in serverless.list()\n    if program.title == "transpile_remote_serverless"\n)\n'})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"QiskitFunction(transpile_remote_serverless)\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'# This cell is hidden from users, it checks the program uploaded correctly\nassert _.title == "transpile_remote_serverless"  # noqa: F821\n'})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'# This cell is hidden from users, it checks the program executes correctly\nfrom time import sleep\nfrom qiskit import QuantumCircuit\n\nqc = QuantumCircuit(2)\ntranspile_remote_serverless = serverless.load("transpile_remote_serverless")\njob = transpile_remote_serverless.run(\n    circuits=[qc],\n    backend="ibm_sherbrooke",\n    optimization_level=1,\n)\nwhile True:\n    sleep(5)\n    status = job.status()\n    if status not in ["QUEUED", "INITIALIZING", "RUNNING", "DONE"]:\n        raise Exception(\n            f"Unexpected job status: \'{status}\'\\n"\n            + "Here are the logs:\\n"\n            + job.logs()\n        )\n    if status == "DONE":\n        break\n'})}),"\n",(0,t.jsx)(s.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,t.jsx)(r,{type:"info",title:"Recommendations",children:(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Learn how to pass inputs and run your program remotely in the ",(0,t.jsx)(s.a,{href:"./serverless-run-first-workload",children:"Run your first Qiskit Serverless workload remotely"})," topic."]}),"\n"]})})]})}function p(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}function u(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},28453(e,s,r){r.d(s,{R:()=>o,x:()=>a});var n=r(96540);const t={},i=n.createContext(t);function o(e){const s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);