"use strict";(globalThis.webpackChunkdoqumentation=globalThis.webpackChunkdoqumentation||[]).push([[7283],{78283(e,i,n){n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"guides/slurm-hpc-ux","title":"SPANK plugin user guide","description":"User guide for the quantum resource management SPANK plugin","source":"@site/i18n/tl/docusaurus-plugin-content-docs/current/guides/slurm-hpc-ux.mdx","sourceDirName":"guides","slug":"/guides/slurm-hpc-ux","permalink":"/guides/slurm-hpc-ux","draft":false,"unlisted":false,"editUrl":"https://github.com/JanLahmann/doQumentation/tree/main/docs/guides/slurm-hpc-ux.mdx","tags":[],"version":"current","frontMatter":{"title":"SPANK plugin user guide","description":"User guide for the quantum resource management SPANK plugin"},"sidebar":"tutorialsSidebar","previous":{"title":"SPANK plugin for QRMI","permalink":"/guides/slurm-plugin"},"next":{"title":"Visualize circuits","permalink":"/guides/visualize-circuits"}}');var r=n(74848),t=n(28453);const c={title:"SPANK plugin user guide",description:"User guide for the quantum resource management SPANK plugin"},o="SPANK plugin user guide",a={},l=[{value:"Configure QPU resources in job creation",id:"configure-qpu-resources-in-job-creation",level:2},{value:"Administrator scope",id:"administrator-scope",level:3},{value:"User scope",id:"user-scope",level:3},{value:"HPC application scope",id:"hpc-application-scope",level:3},{value:"Backend specifics",id:"backend-specifics",level:3},{value:"IBM Direct Access API",id:"ibm-direct-access-api",level:4},{value:"Administrator scope",id:"administrator-scope-1",level:5},{value:"User scope",id:"user-scope-1",level:5},{value:"Qiskit Runtime Service",id:"qiskit-runtime-service",level:4},{value:"User scope",id:"user-scope-2",level:5},{value:"Pasqal Cloud Services",id:"pasqal-cloud-services",level:4},{value:"HPC admin scope",id:"hpc-admin-scope",level:5},{value:"HPC user scope",id:"hpc-user-scope",level:5}];function d(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components},{Admonition:n}=i;return n||function(e,i){throw new Error("Expected "+(i?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Admonition",!0),(0,r.jsxs)(r.Fragment,{children:["\n",(0,r.jsx)(i.admonition,{title:"Hindi pa naisalin",type:"note",children:(0,r.jsx)(i.p,{children:"Ang pahinang ito ay hindi pa naisalin. Nakikita mo ang orihinal na bersyon sa Ingles."})}),"\n","\n",(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"spank-plugin-user-guide",children:"SPANK plugin user guide"})}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.a,{href:"https://github.com/qiskit-community/spank-plugins/",children:"SPANK plugin"})," for the ",(0,r.jsx)(i.a,{href:"/guides/qrmi",children:"Quantum Resource Management Interface (QRMI)"})," is used to configure access to quantum resources from user jobs in a compute environment administrated by the ",(0,r.jsx)(i.a,{href:"https://slurm.schedmd.com/quickstart.html",children:"Slurm"})," workload manager. This is a guide for plugin users to configure QPU resource allocation when creating Slurm jobs."]}),"\n",(0,r.jsx)(i.p,{children:"The Slurm QPU resource definitions determine what physical resources can be used by Slurm jobs in high-performance compute (HPC) environments. User source code should be agnostic to specific backend instances, and even backend types whenever possible. This keeps source code portable while the QPU selection criteria are part of the resource definition (which is considered configuration rather than source code)."}),"\n",(0,r.jsx)(i.h2,{id:"configure-qpu-resources-in-job-creation",children:"Configure QPU resources in job creation"}),"\n",(0,r.jsx)(n,{type:"caution",children:(0,r.jsx)(i.p,{children:"Note that this plugin is under active development and the exact syntax is subject to change."})}),"\n",(0,r.jsx)(i.h3,{id:"administrator-scope",children:"Administrator scope"}),"\n",(0,r.jsx)(i.p,{children:"HPC administrators configure the SPANK plugin to specify what physical resources can be provided to Slurm jobs.\nThis configuration contains all the information needed to have Slurm jobs access the physical resources, such as endpoints and access credentials."}),"\n",(0,r.jsxs)(i.p,{children:["Read the ",(0,r.jsx)(i.a,{href:"https://github.com/qiskit-community/spank-plugins/blob/main/plugins/spank_qrmi/qrmi_config.json.example",children:(0,r.jsx)(i.code,{children:"qrmi_config.json.example"})})," for a comprehensive example configuration."]}),"\n",(0,r.jsxs)(i.p,{children:["In ",(0,r.jsx)(i.code,{children:"slurm.conf"}),", QPU resources can be assigned to some or all nodes for usage:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"...\nGresTypes=qpu,name\nNodeName=node[1-5000] Gres=qpu,name:ibm_fez\n...\n"})}),"\n",(0,r.jsx)(i.h3,{id:"user-scope",children:"User scope"}),"\n",(0,r.jsx)(i.p,{children:"HPC users submit jobs using QPU resources that are tied to Slurm QPU resources. The name attribute references what the HPC administrator has defined. During a Slurm job's runtime, backend selection can be based on criteria other than a predefined name referring to a specific backend (for example, by capacity and error rate qualifiers, to help down-select among the defined set of backends)."}),"\n",(0,r.jsx)(i.p,{children:"There might be additional environment variables required, depending on the backend type."}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.code,{children:"SBATCH"})," parameters will point to one or more QPU resources assigned to the application as generic resources.\nEnvironment variables provided through the plugin will provide the necessary information to the application (see the ",(0,r.jsx)(i.a,{href:"#hpc-application-scope",children:"HPC application scope"})," section for details)."]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-shell",children:"#SBATCH --time=100\n#SBATCH --output=<LOGS_PATH>\n#SBATCH --gres=qpu:1\n#SBATCH --qpu=ibm_fez\n#SBATCH --... # other options\n\nsrun ...\n"})}),"\n",(0,r.jsxs)(i.p,{children:["To use more QPU resources, add more QPUs to the ",(0,r.jsx)(i.code,{children:"--qpu"})," parameter:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-shell",children:"#SBATCH --time=100\n#SBATCH --output=<LOGS_PATH>\n#SBATCH --gres=qpu:3\n#SBATCH --qpu=my_local_qpu,ibm_fez,ibm_marrakesh\n#SBATCH --... # other options\n\nsrun ...\n"})}),"\n",(0,r.jsx)(i.h3,{id:"hpc-application-scope",children:"HPC application scope"}),"\n",(0,r.jsx)(i.p,{children:"HPC applications use the Slurm QPU resources assigned to the Slurm job."}),"\n",(0,r.jsxs)(i.p,{children:["Environment variables provide more details for use by the application; for example, ",(0,r.jsx)(i.code,{children:"SLURM_JOB_QPU_RESOURCES"})," lists the quantum resource names (comma-separated if several are provided).\nThese variables will be used by QRMI. (See the README files in the various QRMI directories (",(0,r.jsx)(i.a,{href:"https://github.com/qiskit-community/qrmi/blob/main/examples/qiskit_primitives/ibm/README.md",children:"IBM"}),", ",(0,r.jsx)(i.a,{href:"https://github.com/qiskit-community/qrmi/blob/main/examples/qiskit_primitives/pasqal/README.md",children:"pasqal"}),") for more details.)"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:'from qiskit import QuantumCircuit\n# Using an IBM QRMI flavor:\nfrom qrmi.primitives import QRMIService\nfrom qrmi.primitives.ibm import SamplerV2, get_backend\n\n# define circuit\n\ncircuit = QuantumCircuit(2)\ncircuit.h(0)\ncircuit.cx(0, 1)\ncircuit.measure_all()\n\n# instantiate QRMI service and get quantum resource (we\'ll take the first one should there be several of them)\n# inject credentials needed for accessing the service at this point\nload_dotenv()\nservice = QRMIService()\n\nresources = service.resources()\nqrmi = resources[0]\n\n# Generate transpiler target from backend configuration & properties and transpile\nbackend = get_backend(qrmi)\npm = generate_preset_pass_manager(\n    optimization_level=1,\n    backend=backend,\n)\n\nisa_circuit = pm.run(circuit)\n\n# Run the circuit\noptions = {}\nsampler = SamplerV2(qrmi, options=options)\n\njob = sampler.run([(isa_circuit, isa_observable, param_values)])\nprint(f">>> Job ID: {job.job_id()}")\n\nresult = job.result()\n\nif job.done():\n    pub_result = result[0]\n    print(f"Counts for the \'meas\' output register: {pub_result.data.meas.get_counts()}")\nelif job.cancelled():\n    print("Cancelled")\nelif job.errored():\n    print(qrmi.task_logs(job.job_id()))\n'})}),"\n",(0,r.jsxs)(i.p,{children:["See the ",(0,r.jsx)(i.a,{href:"https://github.com/qiskit-community/qrmi/tree/main/examples/qiskit_primitives/",children:"examples directory"})," for example files."]}),"\n",(0,r.jsx)(i.h3,{id:"backend-specifics",children:"Backend specifics"}),"\n",(0,r.jsx)(i.h4,{id:"ibm-direct-access-api",children:"IBM Direct Access API"}),"\n",(0,r.jsx)(i.h5,{id:"administrator-scope-1",children:"Administrator scope"}),"\n",(0,r.jsx)(i.p,{children:"Configuration of Direct Access API backends (HPC admin scope) includes endpoints and credentials to the Direct Access endpoint and authentication services, as well as to the S3 endpoint.\nSpecifically, this includes:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"IBM Cloud\xae API key for creating bearer tokens"}),"\n",(0,r.jsx)(i.li,{children:"Endpoint of the Direct Access API"}),"\n",(0,r.jsx)(i.li,{children:"S3 bucket and access details"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"Access credentials should not be visible to HPC users or other non-privileged users on the system.\nTherefore, sensitive data can be put in separate files, which can be access-protected accordingly."}),"\n",(0,r.jsx)(i.p,{children:"Note that Slurm has full access to the backend.\nThis has several implications:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"The Slurm plugin is responsible for multi-tenancy (ensuring that users don't see results of other users' jobs)"}),"\n",(0,r.jsx)(i.li,{children:"The HPC cluster side is responsible for vetting users (who is allowed to access the QPU) and ensuring according access"}),"\n",(0,r.jsx)(i.li,{children:"The capacity and priority of the QPU usage is solely managed through Slurm; there is no other scheduling of users involved outside of Slurm"}),"\n"]}),"\n",(0,r.jsx)(i.h5,{id:"user-scope-1",children:"User scope"}),"\n",(0,r.jsx)(i.p,{children:"Execution lanes are not exposed to the HPC administrator or user directly.\nInstead, during runtime, there can be two different modes that HPC users can specify:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"exclusive=true"})," specifies that no other jobs can use the resource at the same time. An exclusive mode job gets all execution lanes and cannot run at the same time as a non-exclusive job"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"exclusive=false"})," allows other jobs to run in parallel. In this case, there can be as many jobs as there are execution lanes, all running at the same time, and the job is assigned one lane"]}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"qiskit-runtime-service",children:"Qiskit Runtime Service"}),"\n",(0,r.jsx)(i.h5,{id:"user-scope-2",children:"User scope"}),"\n",(0,r.jsx)(i.p,{children:"It is expected that users specify additional access details in environment variables.\nSpecifically, this includes the following:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Qiskit Runtime service instance (CRN, Cloud Resource Name)"}),"\n",(0,r.jsx)(i.li,{children:"Endpoint for Qiskit Runtime (unless auto-detected from the CRN)"}),"\n",(0,r.jsx)(i.li,{children:"API key, which has access to the CRN"}),"\n",(0,r.jsx)(i.li,{children:"S3 instance, bucket, and access token/credentials for data transfers"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"These details determine under which user and service instance the Qiskit Runtime service is used.\nAccordingly, IBM Quantum\xae Platform scheduling considers the user's and service instance's capabilities for scheduling."}),"\n",(0,r.jsx)(i.p,{children:"At this time, users must provide the above details (no shared cluster-wide quantum access)."}),"\n",(0,r.jsx)(i.h4,{id:"pasqal-cloud-services",children:"Pasqal Cloud Services"}),"\n",(0,r.jsx)(i.h5,{id:"hpc-admin-scope",children:"HPC admin scope"}),"\n",(0,r.jsx)(i.p,{children:"There is no specific setup required from HPC admins for PCS usage."}),"\n",(0,r.jsx)(i.h5,{id:"hpc-user-scope",children:"HPC user scope"}),"\n",(0,r.jsx)(i.p,{children:"It is expected that users specify additional access details in environment variables.\nCurrently, this includes the following:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"PCS resource to target (FRESNEL, EMU_FRESNEL, EMU_MPS)"}),"\n",(0,r.jsx)(i.li,{children:"Authorization token"}),"\n"]})]})}function u(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453(e,i,n){n.d(i,{R:()=>c,x:()=>o});var s=n(96540);const r={},t=s.createContext(r);function c(e){const i=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:i},e.children)}}}]);