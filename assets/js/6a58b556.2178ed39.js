"use strict";(globalThis.webpackChunkdoqumentation=globalThis.webpackChunkdoqumentation||[]).push([[377],{84001(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"guides/slurm-plugin","title":"SPANK plugin for QRMI","description":"Overview of the SPANK plugin for quantum resource management in HPC systems.","source":"@site/i18n/tl/docusaurus-plugin-content-docs/current/guides/slurm-plugin.mdx","sourceDirName":"guides","slug":"/guides/slurm-plugin","permalink":"/guides/slurm-plugin","draft":false,"unlisted":false,"editUrl":"https://github.com/JanLahmann/doQumentation/tree/main/docs/guides/slurm-plugin.mdx","tags":[],"version":"current","frontMatter":{"title":"SPANK plugin for QRMI","description":"Overview of the SPANK plugin for quantum resource management in HPC systems."},"sidebar":"tutorialsSidebar","previous":{"title":"Quantum resource management interface (QRMI)","permalink":"/guides/qrmi"},"next":{"title":"SPANK plugin user guide","permalink":"/guides/slurm-hpc-ux"}}');var r=s(74848),t=s(28453);const o={title:"SPANK plugin for QRMI",description:"Overview of the SPANK plugin for quantum resource management in HPC systems."},l="SPANK plugin for QRMI",c={},a=[{value:"Requirements and configuration",id:"requirements-and-configuration",level:2},{value:"Configure available quantum resources",id:"configure-available-quantum-resources",level:3},{value:"Installation",id:"installation",level:2},{value:"Logging",id:"logging",level:2},{value:"Considerations for multiple QPUs",id:"considerations-for-multiple-qpus",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Admonition:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Admonition",!0),(0,r.jsxs)(r.Fragment,{children:["\n",(0,r.jsx)(n.admonition,{title:"Hindi pa naisalin",type:"note",children:(0,r.jsx)(n.p,{children:"Ang pahinang ito ay hindi pa naisalin. Nakikita mo ang orihinal na bersyon sa Ingles."})}),"\n","\n",(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"spank-plugin-for-qrmi",children:"SPANK plugin for QRMI"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.a,{href:"https://github.com/qiskit-community/spank-plugins/",children:"SPANK plugin"})," for the ",(0,r.jsx)(n.a,{href:"/guides/qrmi",children:"Quantum Resource Management Interface (QRMI)"})," is used to configure access to quantum resources from user jobs in a compute environment administrated by the ",(0,r.jsx)(n.a,{href:"https://slurm.schedmd.com/quickstart.html",children:"Slurm"})," workload manager. It handles the acquisition and release of access to quantum resources and sets the necessary environment variables for executing quantum workloads. The available quantum resources are specified in a ",(0,r.jsx)(n.code,{children:"qrmi_config.json"})," file, which is managed by an administrator."]}),"\n",(0,r.jsx)(n.p,{children:"Once installed, this plugin registers the following option. A Slurm user can specify which quantum resources are used for the Slurm job script."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"--qpu=names             Comma separated list of QPU resources to use.\n"})}),"\n",(0,r.jsx)(n.p,{children:"For example,"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n\n#SBATCH --job-name=sampler_job\n#SBATCH --ntasks=1\n#SBATCH --cpus-per-task=1\n#SBATCH --qpu=ibm_quebec,ibm_sherbrooke\n\n# Your script goes here...\n"})}),"\n",(0,r.jsx)(n.h2,{id:"requirements-and-configuration",children:"Requirements and configuration"}),"\n",(0,r.jsx)(n.p,{children:"The following tools are required for the compiling environment:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.rust-lang.org/tools/install",children:"Rust compiler"})," 1.86 or above"]}),"\n",(0,r.jsx)(n.li,{children:"A C compiler: for example, GCC (gcc) on Linux and Clang (clang-tools-extra) for Rust unknown targets/cross compilations. QRMI and its SPANK plugin are compatible with a compiler conforming to the C11 standard"}),"\n",(0,r.jsx)(n.li,{children:"make/cmake (make/cmake RPM for RHEL-compatible OS)"}),"\n",(0,r.jsx)(n.li,{children:"openssl (openssl-devel RPM for RHEL-compatible OS)"}),"\n",(0,r.jsx)(n.li,{children:"zlib (zlib-devel RPM for RHEL-compatible OS)"}),"\n",(0,r.jsx)(n.li,{children:"Slurm header files(slurm/slurm.h and so forth) must be available on your host"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The runtime environment requires:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"gcc (libgcc RPM for RHEL-compatible OS)"}),"\n",(0,r.jsx)(n.li,{children:"openssl (openssl-libs RPM for RHEL-compatible OS)"}),"\n",(0,r.jsx)(n.li,{children:"zlib (zlib RPM for RHEL-compatible OS)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configure-available-quantum-resources",children:"Configure available quantum resources"}),"\n",(0,r.jsxs)(n.p,{children:["The repository contains an example configuration (",(0,r.jsx)(n.a,{href:"https://github.com/qiskit-community/spank-plugins/blob/main/plugins/spank_qrmi/qrmi_config.json.example",children:(0,r.jsx)(n.code,{children:"qrmi_config.json.example"})}),")."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"resources"})," array contains a set of available quantum resources. Each quantum resource definition contains the following:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Property"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"name"}),(0,r.jsx)(n.td,{children:"Quantum resource name (for example, backend name)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"type"}),(0,r.jsxs)(n.td,{children:["Resource type (",(0,r.jsx)(n.code,{children:"direct-access"}),", ",(0,r.jsx)(n.code,{children:"qiskit-runtime-service"})," and ",(0,r.jsx)(n.code,{children:"pasqal-cloud"}),")"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"environment"}),(0,r.jsx)(n.td,{children:"A set of environment variables to work with QRMI. Current implementations assume API endpoint and credentials are specified via environment variable setting"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["If a user specifies a resource with the ",(0,r.jsx)(n.code,{children:"--qpu"})," option that is not defined in the ",(0,r.jsx)(n.code,{children:"qrmi_config.json"})," file, the specification will be ignored."]}),"\n",(0,r.jsxs)(n.p,{children:["If the user sets the necessary environment variables for job execution themselves, it is not required to specify them in this file. In this case, the environment property will be ",(0,r.jsx)(n.code,{children:"{}"}),"."]}),"\n",(0,r.jsxs)(s,{type:"note",children:[(0,r.jsxs)(n.p,{children:["If you are using a QPU resource with the resource type ",(0,r.jsx)(n.code,{children:"qiskit-runtime-service"}),", use an account that supports ",(0,r.jsx)(n.a,{href:"/guides/run-jobs-session#open-a-session",children:"opening a session"}),", such as a Premium Plan account."]}),(0,r.jsxs)(n.p,{children:["If you are using an account that does not support opening a session, such as an Open Plan account, add ",(0,r.jsx)(n.code,{children:'QRMI_IBM_QRS_SESSION_MODE="batch"'})," to the environment variable list in qrmi_config.json as aworkaround."]})]}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsxs)(n.p,{children:["Run the build using ",(0,r.jsx)(n.code,{children:"make"})," and ",(0,r.jsx)(n.code,{children:"cmake"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell-session",children:". ~/.cargo/env\nmkdir build\ncd build\ncmake ..\nmake\n"})}),"\n",(0,r.jsxs)(n.p,{children:["By default, the ",(0,r.jsx)(n.code,{children:"CMakeLists.txt"})," file expects the Slurm header file (",(0,r.jsx)(n.code,{children:"slurm.h"}),") to be located in ",(0,r.jsx)(n.code,{children:"/usr/include/slurm"}),", but this can be customized as shown below."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell-session",children:"SLURM_INCLUDE_DIRS=<directory containing slurm/slurm.h> cmake ..\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If the above build step is successful, a Linux shared library named ",(0,r.jsx)(n.code,{children:"spank_qrmi.so"})," will be created under the ",(0,r.jsx)(n.code,{children:"build/"})," directory."]}),"\n",(0,r.jsxs)(n.p,{children:["In addition, add the following one line to the ",(0,r.jsx)(n.code,{children:"/etc/slurm/plugstack.conf"})," on the nodes where this plugin is installed (note that an administrator needs to create the ",(0,r.jsx)(n.code,{children:"qrmi_config.json"})," file and specify the path as a plugin argument, as in the following):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"optional /usr/lib64/slurm/spank_qrmi.so /etc/slurm/qrmi_config.json\n"})}),"\n",(0,r.jsxs)(s,{type:"note",children:[(0,r.jsx)(n.p,{children:"You can use the available optional arguments to add environment variables to the Slurm process where the SPANK plugin is loaded. The format for specifying environment variables is defined as follows."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"--env:{variable name}={value}\n"})}),(0,r.jsxs)(n.p,{children:["For example, when interacting with quantum resources via an HTTP proxy, the environment variables ",(0,r.jsx)(n.code,{children:"http_proxy"}),", ",(0,r.jsx)(n.code,{children:"https_proxy"}),", and ",(0,r.jsx)(n.code,{children:"no_proxy"})," are required. These can be added as shown below."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"optional /usr/lib64/slurm/spank_qrmi.so /etc/slurm/qrmi_config.json --env:http_proxy=http://192.168.1.128:3128 --env:https_proxy=http://192.168.1.128:3128\n"})})]}),"\n",(0,r.jsx)(n.p,{children:"For the allocator node, your don't need to specify the path to qrmi_config.json, as in the following."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"optional /usr/lib64/slurm/spank_qrmi.so\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The following table shows which Slurm context nodes these files should be copied to. For more details of each context, refer to the ",(0,r.jsx)(n.a,{href:"https://slurm.schedmd.com/spank.html#SECTION_SPANK-PLUGINS",children:"documentation"})," for the SPANK plugin."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Files"}),(0,r.jsx)(n.th,{children:"Slurm contexts"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"plugstack.conf"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"local"}),", ",(0,r.jsx)(n.strong,{children:"remote"}),", ",(0,r.jsx)(n.strong,{children:"allocator"}),", ",(0,r.jsx)(n.strong,{children:"slurmd"}),", and ",(0,r.jsx)(n.strong,{children:"job_script"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"qrmi_config.json"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"remote"})," (Compute nodes)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"spank_qrmi.so"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"allocator"})," and ",(0,r.jsx)(n.strong,{children:"remote"})," (Login nodes and compute nodes)"]})]})]})]}),"\n",(0,r.jsx)(s,{type:"note",children:(0,r.jsxs)(n.p,{children:["Once ",(0,r.jsx)(n.code,{children:"plugstack.conf"})," is updated, SPANK plugins will be loaded at runtime during the next job launch, which means administrators do not need to restart the Slurm cluster."]})}),"\n",(0,r.jsxs)(n.p,{children:["Once you complete installation, you should find the ",(0,r.jsx)(n.code,{children:"--qpu=names"})," option in the ",(0,r.jsx)(n.code,{children:"sbatch"})," help message."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"Options provided by plugins:\n      --qpu=names             Comma-separated list of QPU resources to use.\n"})}),"\n",(0,r.jsx)(n.h2,{id:"logging",children:"Logging"}),"\n",(0,r.jsxs)(n.p,{children:["This plugin uses the Slurm logger for logging. Log messages from this plugin can be found in ",(0,r.jsx)(n.code,{children:"/var/log/slurm/slurmd.log"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'[2025-07-31T09:43:34.019] [21.batch] debug:  spank: /etc/slurm/plugstack.conf:1: Loaded plugin spank_qrmi.so\n[2025-07-31T09:43:34.019] [21.batch] debug:  spank_qrmi_c(6582, 0): -> slurm_spank_init argc=1 remote=1\n[2025-07-31T09:43:34.019] [21.batch] debug:  SPANK: appending plugin option "qpu"\n[2025-07-31T09:43:34.019] [21.batch] debug:  spank_qrmi_c(6582,0): <- slurm_spank_init rc=0\n[2025-07-31T09:43:34.019] [21.batch] debug2: spank: spank_qrmi.so: init = 0\n[2025-07-31T09:43:34.019] [21.batch] debug:  spank_qrmi_c: --qpu=[ibm_sherbrooke,ibm_torino]\n[2025-07-31T09:43:34.019] [21.batch] debug:  spank_qrmi_c(6582, 0): -> slurm_spank_init_post_opt argc=1 remote=1\n[2025-07-31T09:43:34.019] [21.batch] debug:  spank_qrmi_c, fffffffb\n[2025-07-31T09:43:34.019] [21.batch] debug:  spank_qrmi_c: argv[0] = [/etc/slurm/qrmi_config.json]\n[2025-07-31T09:43:34.020] [21.batch] debug:  spank_qrmi_c: name(ibm_sherbrooke), type(1) found in qrmi_config\n'})}),"\n",(0,r.jsxs)(n.p,{children:["You can enable the QRMI runtime log by specifying the following ",(0,r.jsx)(n.code,{children:"srun"})," arguments."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.th,{children:[(0,r.jsx)(n.code,{children:"sbatch"}),"/",(0,r.jsx)(n.code,{children:"srun"})," option"]}),(0,r.jsx)(n.th,{children:"Slurm log level (SRUN_DEBUG)"}),(0,r.jsx)(n.th,{children:"QRMI log level (RUST_LOG)"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"(default)"}),(0,r.jsx)(n.td,{children:"3"}),(0,r.jsx)(n.td,{children:"info"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--quiet"})}),(0,r.jsx)(n.td,{children:"2"}),(0,r.jsx)(n.td,{children:"error"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--verbose"})}),(0,r.jsx)(n.td,{children:"4"}),(0,r.jsx)(n.td,{children:"debug"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"-vv"})," or more"]}),(0,r.jsx)(n.td,{children:"5"}),(0,r.jsx)(n.td,{children:"trace"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"considerations-for-multiple-qpus",children:"Considerations for multiple QPUs"}),"\n",(0,r.jsxs)(n.p,{children:["At runtime, each QRMI instance is linked to a single QPU resource. To enable the use of multiple quantum resources within a single job script, this plugin sets environment variables with the resource name as a prefix. For example, if ",(0,r.jsx)(n.code,{children:"--qpu=qpu1,qpu2"})," is specified, the environment variables will be set as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"qpu1_QRMI_IBM_DA_ENDPOINT=http://test1\nqpu2_QRMI_IBM_DA_ENDPOINT=http://test2\n"})}),"\n",(0,r.jsx)(n.p,{children:"This ensures that each QRMI instance operates with the configuration parameters set for its respective resource during the execution of the Slurm job."}),"\n",(0,r.jsxs)(n.p,{children:["The above environment variable settings are applied only to jobs where the ",(0,r.jsx)(n.code,{children:"--qpu=names"})," option is specified."]}),"\n",(0,r.jsx)(n.p,{children:"This plugin also sets the following two environment variables, which are referred by the QRMI primitives code."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Environment variable"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SLURM_JOB_QPU_RESOURCES"})}),(0,r.jsxs)(n.td,{children:["Comma-separated list of QPU resources to use at runtime. Undocumented resources will be filtered out. For example, ",(0,r.jsx)(n.code,{children:"qpu1,qpu2"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SLURM_JOB_QPU_TYPES"})}),(0,r.jsxs)(n.td,{children:["Comma-separated list of resource type (",(0,r.jsx)(n.code,{children:"direct-access"}),", ",(0,r.jsx)(n.code,{children:"qiskit-runtime-service"}),", and ",(0,r.jsx)(n.code,{children:"pasqal-cloud"}),"). For example, ",(0,r.jsx)(n.code,{children:"direct-access,pasqal-cloud"})]})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453(e,n,s){s.d(n,{R:()=>o,x:()=>l});var i=s(96540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);